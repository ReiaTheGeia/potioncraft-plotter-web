{"version":3,"file":"client.ba3578946cd10795b958.bundle.js","mappings":"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","sources":["webpack://potioncraft-plotter/./src/style.css","webpack://potioncraft-plotter/./src/style.css?7163","webpack://potioncraft-plotter/./src/components/App.tsx","webpack://potioncraft-plotter/./src/components/IncDecSlider.tsx","webpack://potioncraft-plotter/./src/components/IngredientSelector.tsx","webpack://potioncraft-plotter/./src/components/Map/Map.tsx","webpack://potioncraft-plotter/./src/components/Map/index.ts","webpack://potioncraft-plotter/./src/components/PanZoomViewport/PanZoomViewport.tsx","webpack://potioncraft-plotter/./src/components/PanZoomViewport/index.ts","webpack://potioncraft-plotter/./src/components/PlotBuilderItemsList.tsx","webpack://potioncraft-plotter/./src/components/PlotEditor/PlotEditor.tsx","webpack://potioncraft-plotter/./src/components/PlotEditor/PlotEditorViewModel.ts","webpack://potioncraft-plotter/./src/components/PlotEditor/components/EntityDetails.tsx","webpack://potioncraft-plotter/./src/components/PlotEditor/components/PlotDetails.tsx","webpack://potioncraft-plotter/./src/components/PlotEditor/components/PointDetails.tsx","webpack://potioncraft-plotter/./src/components/PlotEditor/components/StepDetails.tsx","webpack://potioncraft-plotter/./src/components/PlotEditor/index.ts","webpack://potioncraft-plotter/./src/components/Plot/Plot.tsx","webpack://potioncraft-plotter/./src/components/Plot/PlotViewModel.ts","webpack://potioncraft-plotter/./src/components/Plot/index.ts","webpack://potioncraft-plotter/./src/container.tsx","webpack://potioncraft-plotter/./src/curves.ts","webpack://potioncraft-plotter/./src/game-settings.ts","webpack://potioncraft-plotter/./src/hooks/component-bounds.ts","webpack://potioncraft-plotter/./src/hooks/native-event.ts","webpack://potioncraft-plotter/./src/hooks/observe.ts","webpack://potioncraft-plotter/./src/index.tsx","webpack://potioncraft-plotter/./src/modifier-keys.ts","webpack://potioncraft-plotter/./src/point-array.ts","webpack://potioncraft-plotter/./src/points.ts","webpack://potioncraft-plotter/./src/rectangles.ts","webpack://potioncraft-plotter/./src/runtime-env.ts","webpack://potioncraft-plotter/./src/services/ingredients/IngredientRegistry.ts","webpack://potioncraft-plotter/./src/services/ingredients/ingredients.ts","webpack://potioncraft-plotter/./src/services/ingredients/module.ts","webpack://potioncraft-plotter/./src/services/ingredients/types.ts","webpack://potioncraft-plotter/./src/services/module.ts","webpack://potioncraft-plotter/./src/services/plotter/PlotBuilder.ts","webpack://potioncraft-plotter/./src/services/plotter/Plotter.ts","webpack://potioncraft-plotter/./src/services/plotter/module.ts","webpack://potioncraft-plotter/./src/services/plotter/types.ts","webpack://potioncraft-plotter/./src/services/potion-bases/PotionBaseRegistry.ts","webpack://potioncraft-plotter/./src/services/potion-bases/module.ts","webpack://potioncraft-plotter/./src/services/potion-maps/PotionMap.ts","webpack://potioncraft-plotter/./src/services/potion-maps/entity-defs.ts","webpack://potioncraft-plotter/./src/services/potion-maps/maps/index.ts","webpack://potioncraft-plotter/./src/services/potion-maps/regions.ts","webpack://potioncraft-plotter/./src/size.ts","webpack://potioncraft-plotter/./src/theme.tsx","webpack://potioncraft-plotter/./src/utils.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"/*\\r\\nThis should be kept minimal and only provide globals\\r\\nor non-react component styles.\\r\\n*/\\r\\n\\r\\nhtml, body, #root {\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n  margin: 0;\\r\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/style.css\"],\"names\":[],\"mappings\":\"AAAA;;;CAGC;;AAED;EACE,WAAW;EACX,YAAY;EACZ,SAAS;AACX\",\"sourcesContent\":[\"/*\\r\\nThis should be kept minimal and only provide globals\\r\\nor non-react component styles.\\r\\n*/\\r\\n\\r\\nhtml, body, #root {\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n  margin: 0;\\r\\n}\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../node_modules/css-loader/dist/cjs.js!./style.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../node_modules/css-loader/dist/cjs.js!./style.css\";\n       export default content && content.locals ? content.locals : undefined;\n","import * as React from \"react\";\r\n\r\nimport PlotEditor from \"./PlotEditor\";\r\n\r\nconst App: React.FC = () => {\r\n  return <PlotEditor />;\r\n};\r\n\r\nexport default App;\r\n","import React from \"react\";\r\n\r\nimport { Slider } from \"@mui/material\";\r\n\r\nexport interface IncDecSliderProps {\r\n  className?: string;\r\n  value: number;\r\n  /**\r\n   * The rate of change at maximum deflection in units per second.\r\n   */\r\n  rate: number;\r\n  onChange(value: number): void;\r\n  onChangeCommitted?(): void;\r\n}\r\n\r\nconst IncDecSlider = ({\r\n  className,\r\n  value,\r\n  rate,\r\n  onChange,\r\n  onChangeCommitted,\r\n}: IncDecSliderProps) => {\r\n  const [delta, setDelta] = React.useState(0);\r\n  React.useEffect(() => {\r\n    const token = setInterval(() => {\r\n      if (delta === 0) {\r\n        return;\r\n      }\r\n\r\n      const newValue = value + delta * rate * (1 / 10);\r\n      onChange(newValue);\r\n    }, 10);\r\n    return () => clearInterval(token);\r\n  }, [value, delta, rate]);\r\n\r\n  return (\r\n    <Slider\r\n      className={className}\r\n      min={-1}\r\n      max={1}\r\n      step={0.01}\r\n      value={delta}\r\n      onChange={(e, v) => {\r\n        setDelta(v as number);\r\n      }}\r\n      onChangeCommitted={() => {\r\n        setDelta(0);\r\n        if (onChangeCommitted) {\r\n          onChangeCommitted();\r\n        }\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default IncDecSlider;\r\n","import React from \"react\";\r\n\r\nimport {\r\n  MenuItem,\r\n  Select,\r\n  SelectProps,\r\n  SelectChangeEvent,\r\n  ListItemText,\r\n  Tooltip,\r\n  styled,\r\n} from \"@mui/material\";\r\n\r\nimport { useDIDependency } from \"@/container\";\r\n\r\nimport {\r\n  IngredientDescriptor,\r\n  IngredientId,\r\n} from \"@/services/ingredients/types\";\r\nimport { IngredientRegistry } from \"@/services/ingredients/IngredientRegistry\";\r\nimport { MAX_INGREDIENT_EXTENT, POTION_RADIUS } from \"@/game-settings\";\r\n\r\nexport interface IngredientSelectorProps\r\n  extends Omit<SelectProps<IngredientId | \"\">, \"value\" | \"onChange\"> {\r\n  value: IngredientId | null;\r\n  allowEmpty?: boolean;\r\n  onChange(value: IngredientId | null): void;\r\n  onMouseOverItem?(value: IngredientId | null): void;\r\n  onMouseOutItem?(): void;\r\n}\r\n\r\nconst StyledTooltip = styled(Tooltip)({\r\n  tooltipPlacementLeft: {\r\n    margin: \"10px 0\",\r\n  },\r\n});\r\n\r\nconst IngredientSelector = ({\r\n  value,\r\n  onChange,\r\n  allowEmpty = false,\r\n  onMouseOverItem,\r\n  onMouseOutItem,\r\n  ...props\r\n}: IngredientSelectorProps) => {\r\n  const registry = useDIDependency(IngredientRegistry);\r\n\r\n  const onSelectChange = React.useCallback(\r\n    (e: SelectChangeEvent<IngredientId | \"\">) => {\r\n      const value = e.target.value;\r\n      if (value === \"\") {\r\n        onChange(null);\r\n      } else {\r\n        onChange(value as any);\r\n      }\r\n    },\r\n    [onChange]\r\n  );\r\n\r\n  return (\r\n    <Select<IngredientId | \"\">\r\n      {...props}\r\n      value={value ?? \"\"}\r\n      onChange={onSelectChange}\r\n    >\r\n      {allowEmpty && <MenuItem value=\"\"></MenuItem>}\r\n      {registry.getIngredients().map((ingredient) => (\r\n        <MenuItem\r\n          key={ingredient.id}\r\n          value={ingredient.id}\r\n          onMouseOver={\r\n            onMouseOverItem ? () => onMouseOverItem(ingredient.id) : undefined\r\n          }\r\n          onMouseOut={onMouseOutItem}\r\n        >\r\n          <StyledTooltip\r\n            placement=\"left\"\r\n            title={\r\n              <svg\r\n                width=\"100px\"\r\n                height=\"100px\"\r\n                viewBox={`-${MAX_INGREDIENT_EXTENT} -${MAX_INGREDIENT_EXTENT} ${\r\n                  MAX_INGREDIENT_EXTENT * 2\r\n                } ${MAX_INGREDIENT_EXTENT * 2}`}\r\n                transform=\"scale(1, -1)\"\r\n              >\r\n                <circle cx={0} cy={0} r={POTION_RADIUS} fill=\"blue\" />\r\n                <path\r\n                  d={ingredient.path.reduce(\r\n                    (path, curve) =>\r\n                      path +\r\n                      `M ${curve.start.x} ${curve.start.y} C ${curve.p1.x},${curve.p1.y} ${curve.p2.x},${curve.p2.y} ${curve.end.x},${curve.end.y}`,\r\n                    \"M 0 0 \"\r\n                  )}\r\n                  stroke=\"black\"\r\n                  strokeWidth={0.2}\r\n                  fill=\"none\"\r\n                />\r\n              </svg>\r\n            }\r\n          >\r\n            <ListItemText>{ingredient.name}</ListItemText>\r\n          </StyledTooltip>\r\n        </MenuItem>\r\n      ))}\r\n    </Select>\r\n  );\r\n};\r\n\r\nexport default IngredientSelector;\r\n","import React from \"react\";\r\nimport { styled } from \"@mui/material\";\r\n\r\nimport { PointZero } from \"@/points\";\r\nimport { degreesToRadians } from \"@/utils\";\r\nimport { SizeZero } from \"@/size\";\r\n\r\nimport { MAP_EXTENT_RADIUS } from \"@/game-settings\";\r\n\r\nimport { useObservation } from \"@/hooks/observe\";\r\n\r\nimport { PotionMap } from \"@/services/potion-maps/PotionMap\";\r\nimport {\r\n  DangerZonePartMapEntity,\r\n  ExperienceBonusMapEntity,\r\n  MapEntity,\r\n  PotionEffectMapEntity,\r\n  VortexMapEntity,\r\n} from \"@/services/potion-maps/types\";\r\n\r\nimport { IMapViewModel } from \"./MapViewModel\";\r\n\r\nexport interface MapProps {\r\n  className?: string;\r\n  map: PotionMap;\r\n  viewModel: IMapViewModel;\r\n}\r\n\r\nconst Root = styled(\"div\")(({ theme }) => ({\r\n  backgroundColor: \"#DABE99\",\r\n  overflow: \"hidden\",\r\n}));\r\n\r\nconst imgCache = new Map<string, HTMLImageElement>();\r\nfunction makeImg(src: string): HTMLImageElement {\r\n  if (imgCache.has(src)) {\r\n    return imgCache.get(src)!;\r\n  }\r\n\r\n  const img = new Image();\r\n  img.onerror = console.error.bind(console);\r\n  img.src = src;\r\n  imgCache.set(src, img);\r\n  return img;\r\n}\r\n\r\nconst MapSlotSrc = require(\"@/assets/MapSlot.png\");\r\n\r\nconst PotionMapComponent = ({ className, map, viewModel }: MapProps) => {\r\n  const { width, height } = useObservation(viewModel.viewportSize$) ?? SizeZero;\r\n  const offset = useObservation(viewModel.viewOffset$) ?? PointZero;\r\n  const scale = useObservation(viewModel.viewScale$) ?? 1;\r\n\r\n  const [canvasRef, setCanvasRef] = React.useState<HTMLCanvasElement | null>(\r\n    null\r\n  );\r\n\r\n  const entities = map.entities;\r\n\r\n  React.useEffect(() => {\r\n    if (!canvasRef) {\r\n      return;\r\n    }\r\n\r\n    const id = requestAnimationFrame(() => {\r\n      const ctx = canvasRef.getContext(\"2d\")!;\r\n\r\n      ctx.clearRect(0, 0, width, height);\r\n\r\n      transformToMap(ctx, scale, offset.x, offset.y, () => {\r\n        // Map border\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = \"red\";\r\n        ctx.lineWidth = 0.2;\r\n        ctx.moveTo(-60, -60);\r\n        ctx.lineTo(-60, 60);\r\n        ctx.lineTo(60, 60);\r\n        ctx.lineTo(60, -60);\r\n        ctx.lineTo(-60, -60);\r\n        ctx.stroke();\r\n\r\n        // ctx.beginPath();\r\n        // ctx.fillStyle = \"blue\";\r\n        // ctx.arc(0, 0, POTION_RADIUS, 0, 2 * Math.PI);\r\n        // ctx.fill();\r\n\r\n        ctx.save();\r\n        const img = makeImg(MapSlotSrc);\r\n        const mapSlotW = img.width / 100;\r\n        const mapSlotH = img.height / 100;\r\n        ctx.scale(1, -1);\r\n        ctx.translate(-mapSlotW / 2, -mapSlotH / 2 - 0.19);\r\n        ctx.drawImage(img, 0, 0, mapSlotW, mapSlotH);\r\n        ctx.restore();\r\n\r\n        for (const entity of entities) {\r\n          renderEntity(ctx, entity);\r\n        }\r\n      });\r\n    });\r\n\r\n    return () => cancelAnimationFrame(id);\r\n  }, [canvasRef, entities, width, height, offset.x, offset.y, scale]);\r\n\r\n  return (\r\n    <Root className={className}>\r\n      <canvas ref={(ref) => setCanvasRef(ref)} width={width} height={height} />\r\n    </Root>\r\n  );\r\n};\r\n\r\nexport default PotionMapComponent;\r\n\r\nfunction transformToMap(\r\n  ctx: CanvasRenderingContext2D,\r\n  zoomFactor: number,\r\n  offsetX: number,\r\n  offsetY: number,\r\n  handler: () => void\r\n) {\r\n  ctx.save();\r\n  ctx.scale(zoomFactor, zoomFactor);\r\n\r\n  ctx.translate(MAP_EXTENT_RADIUS, MAP_EXTENT_RADIUS);\r\n\r\n  ctx.scale(1, -1);\r\n\r\n  // Offset is in map units, so apply after the inversion of y.\r\n  ctx.translate(offsetX, offsetY);\r\n\r\n  handler();\r\n  ctx.restore();\r\n}\r\n\r\nfunction renderEntity(ctx: CanvasRenderingContext2D, entity: MapEntity) {\r\n  switch (entity.entityType) {\r\n    case \"DangerZonePart\":\r\n      renderDangerZonePart(ctx, entity);\r\n      return;\r\n    case \"PotionEffect\":\r\n      renderPotionEffectEntity(ctx, entity);\r\n      return;\r\n    case \"ExperienceBonus\":\r\n      renderExperienceBonusEntity(ctx, entity);\r\n      return;\r\n    case \"Vortex\":\r\n      renderVortexEntity(ctx, entity);\r\n      return;\r\n  }\r\n}\r\n\r\nconst DangerZoneImageSrces: Record<string, string> = {\r\n  Bone1: require(\"@/assets/danger-zone-parts/Bone1.png\"),\r\n  Bone2: require(\"@/assets/danger-zone-parts/Bone2.png\"),\r\n  Fang1: require(\"@/assets/danger-zone-parts/Fang1.png\"),\r\n  Fang2: require(\"@/assets/danger-zone-parts/Fang2.png\"),\r\n  Skull1: require(\"@/assets/danger-zone-parts/Skull1.png\"),\r\n};\r\n\r\nfunction renderDangerZonePart(\r\n  ctx: CanvasRenderingContext2D,\r\n  entity: DangerZonePartMapEntity\r\n) {\r\n  ctx.save();\r\n\r\n  ctx.translate(entity.x, entity.y);\r\n  ctx.rotate(degreesToRadians(entity.angle));\r\n\r\n  const src = DangerZoneImageSrces[entity.prefab];\r\n  if (src) {\r\n    const img = makeImg(src);\r\n    const w = img.width / 130;\r\n    const h = img.height / 130;\r\n    ctx.scale(1, -1);\r\n    ctx.translate(-w / 2, -h / 2);\r\n    ctx.drawImage(img, 0, 0, w, h);\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n\r\nconst PotionEffectImageSrces: Record<string, string> = {\r\n  Acid: require(\"@/assets/potion-effects/Acid.webp\"),\r\n  Berserker: require(\"@/assets/potion-effects/Berserker.webp\"),\r\n  Bounce: require(\"@/assets/potion-effects/Bounce.webp\"),\r\n  Charm: require(\"@/assets/potion-effects/Charm.webp\"),\r\n  Crop: require(\"@/assets/potion-effects/Crop.webp\"),\r\n  Explosion: require(\"@/assets/potion-effects/Explosion.webp\"),\r\n  Fire: require(\"@/assets/potion-effects/Fire.webp\"),\r\n  Fly: require(\"@/assets/potion-effects/Fly.webp\"),\r\n  Frost: require(\"@/assets/potion-effects/Frost.webp\"),\r\n  Growth: require(\"@/assets/potion-effects/Growth.webp\"),\r\n  Hallucinations: require(\"@/assets/potion-effects/Hallucinations.webp\"),\r\n  Healing: require(\"@/assets/potion-effects/Healing.webp\"),\r\n  Invisibility: require(\"@/assets/potion-effects/Invisibility.webp\"),\r\n  Libido: require(\"@/assets/potion-effects/Libido.webp\"),\r\n  Light: require(\"@/assets/potion-effects/Light.webp\"),\r\n  Lightning: require(\"@/assets/potion-effects/Lightning.webp\"),\r\n  Mana: require(\"@/assets/potion-effects/Mana.webp\"),\r\n  Necromancy: require(\"@/assets/potion-effects/Necromancy.webp\"),\r\n  Poison: require(\"@/assets/potion-effects/Poison.webp\"),\r\n  SharpVision: require(\"@/assets/potion-effects/SharpVision.webp\"),\r\n  Sleep: require(\"@/assets/potion-effects/Sleep.webp\"),\r\n  SlowDown: require(\"@/assets/potion-effects/SlowDown.webp\"),\r\n  StoneSkin: require(\"@/assets/potion-effects/StoneSkin.webp\"),\r\n};\r\n\r\nconst EffectSlotSrc = require(\"@/assets/EffectSlot.png\");\r\nfunction renderPotionEffectEntity(\r\n  ctx: CanvasRenderingContext2D,\r\n  entity: PotionEffectMapEntity\r\n) {\r\n  // Line from effect to origin\r\n  ctx.save();\r\n  var grad = ctx.createLinearGradient(entity.x, entity.y, 0, 0);\r\n  grad.addColorStop(0, \"#D2AA7B\");\r\n  grad.addColorStop(1, \"transparent\");\r\n  ctx.strokeStyle = grad;\r\n  ctx.lineWidth = 0.05;\r\n  ctx.beginPath();\r\n  ctx.moveTo(entity.x, entity.y);\r\n  ctx.lineTo(0, 0);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n\r\n  // Effect artwork\r\n  ctx.save();\r\n\r\n  ctx.translate(entity.x, entity.y);\r\n\r\n  // ctx.beginPath();\r\n  // ctx.fillStyle = \"red\";\r\n  // ctx.arc(0, 0, POTION_RADIUS, 0, 2 * Math.PI);\r\n  // ctx.fill();\r\n\r\n  const container = makeImg(EffectSlotSrc);\r\n  const containerW = container.width / 100;\r\n  const containerH = container.height / 100;\r\n  ctx.save();\r\n  ctx.scale(1, -1);\r\n  ctx.translate(-containerW / 2, -containerH / 2 - 0.2);\r\n  ctx.drawImage(container, 0, 0, containerW, containerH);\r\n  ctx.restore();\r\n\r\n  const src = PotionEffectImageSrces[entity.effect];\r\n  if (src) {\r\n    const img = makeImg(src);\r\n    const w = img.width / 40;\r\n    const h = img.height / 40;\r\n    ctx.scale(1, -1);\r\n    ctx.translate(-w / 2, -h / 2);\r\n    ctx.drawImage(img, 0, 0, w, h);\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n\r\nconst ExperienceBonusImagesSrc: Record<string, string> = {\r\n  Little: require(\"@/assets/experience-bonus/xp-small.png\"),\r\n  Medium: require(\"@/assets/experience-bonus/xp-medium.png\"),\r\n  Large: require(\"@/assets/experience-bonus/xp-large.png\"),\r\n};\r\n\r\nfunction renderExperienceBonusEntity(\r\n  ctx: CanvasRenderingContext2D,\r\n  entity: ExperienceBonusMapEntity\r\n) {\r\n  ctx.save();\r\n  ctx.translate(entity.x, entity.y);\r\n\r\n  const src = ExperienceBonusImagesSrc[entity.prefab];\r\n  if (src) {\r\n    const img = makeImg(src);\r\n    const w = img.width / 200;\r\n    const h = img.height / 200;\r\n    ctx.save();\r\n    ctx.scale(1, -1);\r\n    ctx.translate(-w / 2, -h / 2);\r\n    ctx.drawImage(img, 0, 0, w, h);\r\n    ctx.restore();\r\n  }\r\n\r\n  // ctx.beginPath();\r\n  // ctx.fillStyle = \"green\";\r\n  // ctx.arc(0, 0, 0.3, 0, 2 * Math.PI);\r\n  // ctx.fill();\r\n\r\n  ctx.restore();\r\n}\r\n\r\nconst VortexImagesSrc: Record<string, string> = {\r\n  Large: require(\"@/assets/vortexes/Vortex Large Idle.png\"),\r\n  Medium: require(\"@/assets/vortexes/Vortex Medium Idle.png\"),\r\n};\r\n\r\nfunction renderVortexEntity(\r\n  ctx: CanvasRenderingContext2D,\r\n  entity: VortexMapEntity\r\n) {\r\n  ctx.save();\r\n  ctx.translate(entity.x, entity.y);\r\n\r\n  // let radius = 0;\r\n  // switch (entity.prefab) {\r\n  //   case \"Large\":\r\n  //     radius = 1.65;\r\n  //     break;\r\n  //   case \"Medium\":\r\n  //     radius = 1.25;\r\n  //     break;\r\n  // }\r\n\r\n  // if (radius > 0) {\r\n  //   ctx.beginPath();\r\n  //   ctx.fillStyle = \"purple\";\r\n  //   ctx.arc(0, 0, radius, 0, 2 * Math.PI);\r\n  //   ctx.fill();\r\n  // }\r\n\r\n  // const backgroundSrc = VortexBackgroundImagesSrc[entity.prefab];\r\n  // if (backgroundSrc) {\r\n  //   const img = makeImg(backgroundSrc);\r\n  //   const w = img.width / 150;\r\n  //   const h = img.height / 150;\r\n  //   ctx.save();\r\n  //   ctx.scale(1, -1);\r\n  //   ctx.translate(-w / 2, -h / 2);\r\n  //   ctx.drawImage(img, 0, 0, w, h);\r\n  //   ctx.restore();\r\n  // }\r\n\r\n  const src = VortexImagesSrc[entity.prefab];\r\n  if (src) {\r\n    const img = makeImg(src);\r\n    const w = img.width / 100;\r\n    const h = img.height / 100;\r\n    ctx.save();\r\n    ctx.scale(1, -1);\r\n    ctx.translate(-w / 2, -h / 2);\r\n    ctx.drawImage(img, 0, 0, w, h);\r\n    ctx.restore();\r\n  }\r\n\r\n  ctx.restore();\r\n}\r\n","import PotionMap from \"./Map\";\r\nexport default PotionMap;\r\n","import * as React from \"react\";\r\nimport { styled } from \"@mui/material\";\r\n\r\nimport { getModifiers } from \"@/modifier-keys\";\r\n\r\nimport { useComponentBounds } from \"@/hooks/component-bounds\";\r\nimport { useNativeEvent } from \"@/hooks/native-event\";\r\n\r\nimport { IPanZoomViewportViewModel } from \"./PanZoomViewportViewModel\";\r\nimport { Point, pointSubtract, PointZero } from \"@/points\";\r\n\r\nexport interface PanZoomHandlerProps {\r\n  className?: string;\r\n  viewModel: IPanZoomViewportViewModel;\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport const ZOOM_FACTOR = 1.15;\r\nexport const PAN_FACTOR = 0.15;\r\n\r\nconst Root = styled(\"div\")({\r\n  width: \"100%\",\r\n  height: \"100%\",\r\n});\r\n\r\nconst PanZoomViewport = ({\r\n  className,\r\n  viewModel,\r\n  children,\r\n}: PanZoomHandlerProps) => {\r\n  const containerRef = React.useRef<HTMLDivElement | null>(null);\r\n  const containerBounds = useComponentBounds(containerRef);\r\n  const [dragPointer, setDragPointer] = React.useState<number | null>(null);\r\n  const [mouseLastPos, setMouseLastPos] = React.useState<Point>(PointZero);\r\n\r\n  React.useLayoutEffect(() => {\r\n    viewModel.onViewportResized(containerBounds.width, containerBounds.height);\r\n  }, [containerBounds.width, containerBounds.height]);\r\n\r\n  const onWheel = React.useCallback((e: WheelEvent) => {\r\n    const target = containerRef.current;\r\n    if (!target || e.defaultPrevented) {\r\n      return;\r\n    }\r\n\r\n    const modifiers = getModifiers(e);\r\n\r\n    if (modifiers.ctrlMetaKey) {\r\n      viewModel.zoom(e.deltaY < 0 ? ZOOM_FACTOR : 1 / ZOOM_FACTOR, {\r\n        x: e.clientX,\r\n        y: e.clientY,\r\n      });\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    } else if (modifiers.shiftKey) {\r\n      viewModel.pan(-e.deltaY * PAN_FACTOR, 0, true);\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    } else {\r\n      viewModel.pan(0, e.deltaY * PAN_FACTOR, true);\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }, []);\r\n\r\n  const onPointerDown = React.useCallback(\r\n    (e: React.PointerEvent<HTMLDivElement>) => {\r\n      if (dragPointer != null) {\r\n        return;\r\n      }\r\n      if (e.defaultPrevented) {\r\n        return;\r\n      }\r\n      e.preventDefault();\r\n      setDragPointer(e.pointerId);\r\n      e.currentTarget.setPointerCapture(e.pointerId);\r\n      setMouseLastPos({ x: e.clientX, y: e.clientY });\r\n    },\r\n    [dragPointer]\r\n  );\r\n\r\n  const onPointerMove = React.useCallback(\r\n    (e: React.PointerEvent<HTMLDivElement>) => {\r\n      if (dragPointer == null) {\r\n        return;\r\n      }\r\n      const p = { x: e.clientX, y: e.clientY };\r\n      const delta = pointSubtract(p, mouseLastPos);\r\n      setMouseLastPos(p);\r\n      // FIXME: Panning is miscalculated.  Mouse drifts from grab position.\r\n      viewModel.pan(delta.x, -delta.y, true);\r\n    },\r\n    [mouseLastPos, viewModel]\r\n  );\r\n\r\n  const onPointerUp = React.useCallback(\r\n    (e: React.PointerEvent) => {\r\n      if (e.pointerId != dragPointer) {\r\n        return;\r\n      }\r\n      setDragPointer(null);\r\n      setMouseLastPos(PointZero);\r\n      e.currentTarget.releasePointerCapture(e.pointerId);\r\n    },\r\n    [dragPointer]\r\n  );\r\n\r\n  const onMouseOut = React.useCallback(\r\n    () => viewModel.onMouseOut(),\r\n    [viewModel]\r\n  );\r\n\r\n  // React listens to the root listener for all events,\r\n  //  and chrome assumes the root event listener for mouse events\r\n  //  never wants to preventDefault.\r\n  // We need to take a local event listener and mark it as not passive.\r\n  // https://github.com/facebook/react/issues/14856\r\n  useNativeEvent(containerRef, \"wheel\", onWheel, { passive: false });\r\n\r\n  return (\r\n    <Root\r\n      className={className}\r\n      ref={containerRef}\r\n      onMouseMove={(e) => viewModel.onMouseMove(e.clientX, e.clientY)}\r\n      onPointerDown={onPointerDown}\r\n      onPointerMove={onPointerMove}\r\n      onPointerUp={onPointerUp}\r\n      onMouseOut={onMouseOut}\r\n    >\r\n      {children}\r\n    </Root>\r\n  );\r\n};\r\n\r\nexport default PanZoomViewport;\r\n","import PanZoomViewport from \"./PanZoomViewport\";\r\nexport default PanZoomViewport;\r\n","import React from \"react\";\r\n\r\nimport {\r\n  styled,\r\n  Card,\r\n  CardContent,\r\n  Typography,\r\n  Slider,\r\n  Grid,\r\n  Button,\r\n  IconButton,\r\n  TextField,\r\n} from \"@mui/material\";\r\nimport { Add as AddIcon, Delete as DeleteIcon } from \"@mui/icons-material\";\r\n\r\nimport { useObservation } from \"@/hooks/observe\";\r\n\r\nimport {\r\n  AddIngredientPlotBuilderItem,\r\n  PlotBuilder,\r\n  PlotBuilderItem,\r\n  PourSolventPlotBuilderItem,\r\n  StirCauldronPlotBuilderItem,\r\n  HeatVortexPlotBuilderItem,\r\n} from \"@/services/plotter/PlotBuilder\";\r\nimport { IngredientId } from \"@/services/ingredients/types\";\r\n\r\nimport IngredientSelector from \"./IngredientSelector\";\r\nimport IncDecSlider from \"./IncDecSlider\";\r\n\r\nexport interface PlotBuilderItemsListProps {\r\n  className?: string;\r\n  builder: PlotBuilder;\r\n  highlightItem?: PlotBuilderItem | null;\r\n  onMouseOver(item: PlotBuilderItem): void;\r\n  onMouseOut(): void;\r\n}\r\n\r\nconst Root = styled(\"div\")(({ theme }) => ({\r\n  overflow: \"auto\",\r\n  boxSixing: \"border-box\",\r\n  display: \"flex\",\r\n  flexDirection: \"column\",\r\n  \"& .list\": {\r\n    listStyle: \"none\",\r\n    paddingLeft: theme.spacing(2),\r\n    paddingRight: theme.spacing(2),\r\n  },\r\n  \"& .list-item\": {\r\n    position: \"relative\",\r\n    marginBottom: theme.spacing(1),\r\n  },\r\n  \"& .list-item .delete-button\": {\r\n    position: \"absolute\",\r\n    top: \"5px\",\r\n    right: \"15px\",\r\n  },\r\n  \"& .buttons\": {\r\n    alignSelf: \"center\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    alignItems: \"center\",\r\n  },\r\n}));\r\n\r\nconst PlotBuilderItemsList = ({\r\n  className,\r\n  builder,\r\n  highlightItem,\r\n  onMouseOver,\r\n  onMouseOut,\r\n}: PlotBuilderItemsListProps) => {\r\n  const items = useObservation(builder.items$) ?? [];\r\n  return (\r\n    <Root className={className}>\r\n      <ul className=\"list\">\r\n        {items.map((item, i) => (\r\n          <PlotListItem\r\n            key={i}\r\n            item={item}\r\n            highlight={item === highlightItem}\r\n            onMouseOver={onMouseOver}\r\n            onMouseOut={onMouseOut}\r\n          />\r\n        ))}\r\n      </ul>\r\n      <div className=\"buttons\">\r\n        <Button color=\"primary\" onClick={() => builder.addIngredient()}>\r\n          <AddIcon /> Ingredient\r\n        </Button>\r\n        <Button color=\"primary\" onClick={() => builder.addStirCauldron()}>\r\n          <AddIcon /> Stir Cauldron\r\n        </Button>\r\n        <Button color=\"primary\" onClick={() => builder.addPourSolvent()}>\r\n          <AddIcon /> Pour Solvent\r\n        </Button>\r\n        <Button color=\"primary\" onClick={() => builder.addHeatVortex()}>\r\n          <AddIcon /> Heat Vortex\r\n        </Button>\r\n      </div>\r\n    </Root>\r\n  );\r\n};\r\n\r\ninterface PlotListItemProps {\r\n  item: PlotBuilderItem;\r\n  highlight?: boolean;\r\n  onMouseOver(item: PlotBuilderItem): void;\r\n  onMouseOut(): void;\r\n}\r\nconst PlotListItem = React.memo(\r\n  ({ item, highlight = false, onMouseOver, onMouseOut }: PlotListItemProps) => {\r\n    if (item instanceof AddIngredientPlotBuilderItem) {\r\n      return (\r\n        <AddIngredientPlotListItem\r\n          item={item}\r\n          highlight={highlight}\r\n          onMouseOver={onMouseOver}\r\n          onMouseOut={onMouseOut}\r\n        />\r\n      );\r\n    } else if (item instanceof StirCauldronPlotBuilderItem) {\r\n      return (\r\n        <StirCauldronPlotListItem\r\n          item={item}\r\n          highlight={highlight}\r\n          onMouseOver={onMouseOver}\r\n          onMouseOut={onMouseOut}\r\n        />\r\n      );\r\n    } else if (item instanceof PourSolventPlotBuilderItem) {\r\n      return (\r\n        <PourSolventPlotListItem\r\n          item={item}\r\n          highlight={highlight}\r\n          onMouseOver={onMouseOver}\r\n          onMouseOut={onMouseOut}\r\n        />\r\n      );\r\n    } else if (item instanceof HeatVortexPlotBuilderItem) {\r\n      return (\r\n        <HeatVortexPlotListItem\r\n          item={item}\r\n          highlight={highlight}\r\n          onMouseOver={onMouseOver}\r\n          onMouseOut={onMouseOut}\r\n        />\r\n      );\r\n    }\r\n    return <div>Unknown PlotItem {item.constructor.name}</div>;\r\n  }\r\n);\r\n\r\ninterface PlotListItemCardProps {\r\n  item: PlotBuilderItem;\r\n  highlight: boolean;\r\n  children: React.ReactNode;\r\n  onMouseOver?(item: PlotBuilderItem): void;\r\n  onMouseOut?(): void;\r\n}\r\n\r\nconst PlotListItemCard = ({\r\n  item,\r\n  highlight,\r\n  children,\r\n  onMouseOver,\r\n  onMouseOut,\r\n}: PlotListItemCardProps) => {\r\n  const valid = useObservation(item.isValid$) ?? false;\r\n  const onCardMouseOver = React.useCallback(() => {\r\n    if (onMouseOver) {\r\n      onMouseOver(item);\r\n    }\r\n  }, [onMouseOver, item]);\r\n  const onDeleteClick = React.useCallback(() => item.delete(), [item]);\r\n  return (\r\n    <Card\r\n      className=\"list-item\"\r\n      style={{\r\n        backgroundColor:\r\n          (!valid && \"salmon\") || (highlight && \"lightblue\") || undefined,\r\n      }}\r\n      onMouseOver={onCardMouseOver}\r\n      onMouseOut={onMouseOut}\r\n    >\r\n      <IconButton\r\n        size=\"small\"\r\n        className=\"delete-button\"\r\n        onClick={onDeleteClick}\r\n      >\r\n        <DeleteIcon />\r\n      </IconButton>\r\n      <CardContent>{children}</CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\ninterface AddIngredientPlotListItemProps {\r\n  item: AddIngredientPlotBuilderItem;\r\n  highlight: boolean;\r\n  onMouseOver(item: PlotBuilderItem): void;\r\n  onMouseOut(): void;\r\n}\r\nconst AddIngredientPlotListItem = ({\r\n  item,\r\n  highlight,\r\n  onMouseOver,\r\n  onMouseOut,\r\n}: AddIngredientPlotListItemProps) => {\r\n  const savedIngredientRef = React.useRef<IngredientId | null>(null);\r\n\r\n  // Need both state (for rerender on change) and ref (to check it in a callback)\r\n  const [isPreviewing, setIsPreviewing] = React.useState<boolean>(false);\r\n  const isPreviewingRef = React.useRef(false);\r\n\r\n  // Note: This is from when a transition was used to show the preview, we wanted\r\n  // the slider to update live while the preview was not.  However, we no longer use\r\n  // transitions as the system is now fast enough to deal without it.\r\n  const [localGrind, setLocalGrind] = React.useState<number | null>(null);\r\n\r\n  const [inputGrindPercent, setInputGrindPercent] = React.useState<\r\n    string | null\r\n  >(null);\r\n\r\n  const ingredientId = useObservation(item.ingredientId$) ?? null;\r\n  const grindPercent = useObservation(item.grindPercent$) ?? 0;\r\n\r\n  const onIngredientSelectorOpen = React.useCallback(() => {\r\n    savedIngredientRef.current = item.ingredientId;\r\n    setIsPreviewing(true);\r\n    isPreviewingRef.current = true;\r\n  }, []);\r\n\r\n  const onIngredientSelectorMouseOverItem = React.useCallback(\r\n    (value: IngredientId) => {\r\n      if (!isPreviewing) {\r\n        return;\r\n      }\r\n      item.setIngredient(value);\r\n    },\r\n    [item]\r\n  );\r\n\r\n  const onIngredientSelectorChange = React.useCallback(\r\n    (value: IngredientId | null) => {\r\n      setIsPreviewing(false);\r\n      isPreviewingRef.current = false;\r\n      item.setIngredient(value);\r\n    },\r\n    [item]\r\n  );\r\n\r\n  const onIngredientSelectorClose = React.useCallback(() => {\r\n    if (isPreviewingRef.current) {\r\n      item.setIngredient(savedIngredientRef.current);\r\n      setIsPreviewing(false);\r\n      isPreviewingRef.current = false;\r\n    }\r\n    savedIngredientRef.current = null;\r\n  }, [item]);\r\n\r\n  const onGrindPercentTextChange = React.useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      let asNumber: number | null = Number(e.target.value) / 100;\r\n      if (isNaN(asNumber) || asNumber < 0 || asNumber > 1) {\r\n        asNumber = null;\r\n      }\r\n\r\n      setInputGrindPercent(e.target.value);\r\n      item.setGrindPercent(asNumber ?? 0);\r\n    },\r\n    [item]\r\n  );\r\n\r\n  const onGrindPercentBlur = React.useCallback(() => {\r\n    setInputGrindPercent(null);\r\n  }, []);\r\n\r\n  const onSliderChange = React.useCallback(\r\n    (_: any, value: number | number[]) => {\r\n      item.setGrindPercent(value as number);\r\n      setLocalGrind(value as number);\r\n    },\r\n    [item]\r\n  );\r\n\r\n  const onSliderChangeCommitted = React.useCallback(\r\n    (_: any, value: number | number[]) => {\r\n      item.setGrindPercent(value as number);\r\n      setLocalGrind(null);\r\n    },\r\n    [item]\r\n  );\r\n\r\n  // We change the ingredientId during mouse over for live feedback, but this changes the ingredient id we wish to display.\r\n  // We need to pin the previously selected id so that IngredientSelector works properly during the selection process.\r\n  const displayIngredientId = isPreviewing\r\n    ? savedIngredientRef.current\r\n    : ingredientId;\r\n  return (\r\n    <PlotListItemCard\r\n      item={item}\r\n      highlight={highlight}\r\n      onMouseOver={localGrind != null ? undefined : onMouseOver}\r\n      onMouseOut={localGrind != null ? undefined : onMouseOut}\r\n    >\r\n      <div>\r\n        <Typography variant=\"overline\">Ingredient</Typography>\r\n      </div>\r\n      <IngredientSelector\r\n        fullWidth\r\n        value={displayIngredientId}\r\n        allowEmpty={displayIngredientId == null}\r\n        // Store the last ingredient when we open, so we can return to it after closing without making a selection.\r\n        onOpen={onIngredientSelectorOpen}\r\n        // Change the ingredient id with the mouse for a live preview.\r\n        onMouseOverItem={onIngredientSelectorMouseOverItem}\r\n        // Change our saved ingredient when the input is committed.  We will restore it when the input closes after the change.\r\n        onChange={onIngredientSelectorChange}\r\n        onClose={onIngredientSelectorClose}\r\n      />\r\n      <Grid paddingTop={1}>\r\n        <TextField\r\n          label=\"Grind Percent\"\r\n          value={inputGrindPercent ?? grindPercent * 100}\r\n          onChange={onGrindPercentTextChange}\r\n          onBlur={onGrindPercentBlur}\r\n        />\r\n        <Slider\r\n          value={localGrind ?? grindPercent}\r\n          onChange={onSliderChange}\r\n          onChangeCommitted={onSliderChangeCommitted}\r\n          min={0}\r\n          max={1}\r\n          step={0.001}\r\n        />\r\n      </Grid>\r\n    </PlotListItemCard>\r\n  );\r\n};\r\n\r\ninterface StirCauldronPlotListItemProps {\r\n  item: StirCauldronPlotBuilderItem;\r\n  highlight: boolean;\r\n  onMouseOver(item: PlotBuilderItem): void;\r\n  onMouseOut(): void;\r\n}\r\n\r\nconst StirCauldronPlotListItem = ({\r\n  item,\r\n  highlight,\r\n  onMouseOver,\r\n  onMouseOut,\r\n}: StirCauldronPlotListItemProps) => {\r\n  const distance = useObservation(item.distance$);\r\n  const [inputDistance, setInputDistance] = React.useState<string | null>(null);\r\n\r\n  const onTextFieldChange = React.useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      let asNumber: number | null = Number(e.target.value);\r\n      if (isNaN(asNumber)) {\r\n        asNumber = null;\r\n      }\r\n\r\n      setInputDistance(e.target.value);\r\n      item.setDistance(asNumber);\r\n    },\r\n    [item]\r\n  );\r\n  const onTextFieldBlur = React.useCallback(() => {\r\n    setInputDistance(null);\r\n  }, []);\r\n  const onDistanceChange = React.useCallback(\r\n    (value: number) => {\r\n      item.setDistance(Math.max(0, Number(value.toFixed(3))));\r\n    },\r\n    [item]\r\n  );\r\n\r\n  return (\r\n    <PlotListItemCard\r\n      item={item}\r\n      highlight={highlight}\r\n      onMouseOver={onMouseOver}\r\n      onMouseOut={onMouseOut}\r\n    >\r\n      <div>\r\n        <Typography variant=\"overline\">Stir Cauldron</Typography>\r\n      </div>\r\n      <TextField\r\n        label=\"Distance\"\r\n        value={inputDistance ?? distance ?? \"\"}\r\n        onChange={onTextFieldChange}\r\n        onBlur={onTextFieldBlur}\r\n      />\r\n      <IncDecSlider\r\n        value={distance ?? 0}\r\n        rate={10}\r\n        onChange={onDistanceChange}\r\n      />\r\n    </PlotListItemCard>\r\n  );\r\n};\r\n\r\ninterface PourSolventPlotListItemProps {\r\n  item: PourSolventPlotBuilderItem;\r\n  highlight: boolean;\r\n  onMouseOver(item: PlotBuilderItem): void;\r\n  onMouseOut(): void;\r\n}\r\nconst PourSolventPlotListItem = ({\r\n  item,\r\n  highlight,\r\n  onMouseOver,\r\n  onMouseOut,\r\n}: PourSolventPlotListItemProps) => {\r\n  const distance = useObservation(item.distance$);\r\n  const [inputDistance, setInputDistance] = React.useState<string | null>(null);\r\n\r\n  const onTextFieldChange = React.useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      let asNumber: number | null = Number(e.target.value);\r\n      if (isNaN(asNumber)) {\r\n        asNumber = null;\r\n      }\r\n\r\n      setInputDistance(e.target.value);\r\n      item.setDistance(asNumber);\r\n    },\r\n    [item]\r\n  );\r\n  const onTextFieldBlur = React.useCallback(() => {\r\n    setInputDistance(null);\r\n  }, []);\r\n  const onDistanceChange = React.useCallback(\r\n    (value: number) => {\r\n      item.setDistance(Math.max(0, Number(value.toFixed(3))));\r\n    },\r\n    [item]\r\n  );\r\n\r\n  return (\r\n    <PlotListItemCard\r\n      item={item}\r\n      highlight={highlight}\r\n      onMouseOver={onMouseOver}\r\n      onMouseOut={onMouseOut}\r\n    >\r\n      <div>\r\n        <Typography variant=\"overline\">Pour Solvent</Typography>\r\n      </div>\r\n      <TextField\r\n        label=\"Distance\"\r\n        value={inputDistance ?? distance ?? \"\"}\r\n        onChange={onTextFieldChange}\r\n        onBlur={onTextFieldBlur}\r\n      />\r\n      <IncDecSlider\r\n        value={distance ?? 0}\r\n        rate={10}\r\n        onChange={onDistanceChange}\r\n      />\r\n    </PlotListItemCard>\r\n  );\r\n};\r\n\r\ninterface HeatVortexPlotListItemProps {\r\n  item: HeatVortexPlotBuilderItem;\r\n  highlight: boolean;\r\n  onMouseOver(item: PlotBuilderItem): void;\r\n  onMouseOut(): void;\r\n}\r\nconst HeatVortexPlotListItem = ({\r\n  item,\r\n  highlight,\r\n  onMouseOver,\r\n  onMouseOut,\r\n}: HeatVortexPlotListItemProps) => {\r\n  const distance = useObservation(item.distance$);\r\n  const [inputDistance, setInputDistance] = React.useState<string | null>(null);\r\n\r\n  const onTextFieldChange = React.useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => {\r\n      let asNumber: number | null = Number(e.target.value);\r\n      if (isNaN(asNumber)) {\r\n        asNumber = null;\r\n      }\r\n\r\n      setInputDistance(e.target.value);\r\n      item.setDistance(asNumber);\r\n    },\r\n    [item]\r\n  );\r\n  const onTextFieldBlur = React.useCallback(() => {\r\n    setInputDistance(null);\r\n  }, []);\r\n  const onDistanceChange = React.useCallback(\r\n    (value: number) => {\r\n      item.setDistance(Math.max(0, Number(value.toFixed(3))));\r\n    },\r\n    [item]\r\n  );\r\n\r\n  return (\r\n    <PlotListItemCard\r\n      item={item}\r\n      highlight={highlight}\r\n      onMouseOver={onMouseOver}\r\n      onMouseOut={onMouseOut}\r\n    >\r\n      <div>\r\n        <Typography variant=\"overline\">Heat Vortex</Typography>\r\n      </div>\r\n      <TextField\r\n        label=\"Distance\"\r\n        value={inputDistance ?? distance ?? \"\"}\r\n        onChange={onTextFieldChange}\r\n        onBlur={onTextFieldBlur}\r\n      />\r\n      <IncDecSlider\r\n        value={distance ?? 0}\r\n        rate={10}\r\n        onChange={onDistanceChange}\r\n      />\r\n    </PlotListItemCard>\r\n  );\r\n};\r\n\r\nexport default PlotBuilderItemsList;\r\n","import React from \"react\";\r\nimport { styled, Card, CardContent, Typography } from \"@mui/material\";\r\n\r\nimport { useDICreate, useDIDependency } from \"@/container\";\r\nimport { PointZero } from \"@/points\";\r\n\r\nimport { useObservation } from \"@/hooks/observe\";\r\n\r\nimport { EmptyPlotResult } from \"@/services/plotter/types\";\r\nimport { PotionBaseRegistry } from \"@/services/potion-bases/PotionBaseRegistry\";\r\n\r\nimport Plot from \"../Plot\";\r\nimport PlotBuilderItemsList from \"../PlotBuilderItemsList\";\r\nimport PotionMap from \"../Map\";\r\nimport PanZoomViewport from \"../PanZoomViewport\";\r\nimport IncDecSlider from \"../IncDecSlider\";\r\n\r\nimport { PlotEditorViewModel } from \"./PlotEditorViewModel\";\r\n\r\nimport PointDetails from \"./components/PointDetails\";\r\nimport StepDetails from \"./components/StepDetails\";\r\nimport PlotDetails from \"./components/PlotDetails\";\r\nimport EntityDetails from \"./components/EntityDetails\";\r\nimport { PlotBuilderItem } from \"@/services/plotter/PlotBuilder\";\r\n\r\nconst Root = styled(\"div\")(({ theme }) => ({\r\n  width: \"100%\",\r\n  height: \"100%\",\r\n  display: \"flex\",\r\n  flexDirection: \"row\",\r\n  \"& .outer-container\": {\r\n    position: \"relative\",\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n  },\r\n  \"& .plot-container\": {\r\n    position: \"relative\",\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n  },\r\n  \"& .map\": {\r\n    position: \"absolute\",\r\n    top: 0,\r\n    left: 0,\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n  },\r\n  \"& .plot\": {\r\n    position: \"absolute\",\r\n    top: 0,\r\n    left: 0,\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n  },\r\n  \"& .plot-details\": {\r\n    position: \"absolute\",\r\n    top: theme.spacing(2),\r\n    right: theme.spacing(2),\r\n  },\r\n  \"& .inspect-stack\": {\r\n    position: \"absolute\",\r\n    top: theme.spacing(2),\r\n    left: theme.spacing(2),\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n  \"& .inspect-stack > *\": {\r\n    marginBottom: theme.spacing(2),\r\n  },\r\n  \"& .mouse-coords\": {\r\n    position: \"absolute\",\r\n    bottom: theme.spacing(2),\r\n    right: theme.spacing(2),\r\n  },\r\n  \"& .zoom\": {\r\n    position: \"absolute\",\r\n    width: \"200px\",\r\n    bottom: theme.spacing(2),\r\n    left: theme.spacing(2),\r\n  },\r\n  \"& .divider\": {\r\n    width: \"2px\",\r\n    height: \"100%\",\r\n    background: \"grey\",\r\n  },\r\n  \"& .plot-items\": {\r\n    width: \"400px\",\r\n    height: \"100%\",\r\n  },\r\n}));\r\n\r\nconst PlotEditor = () => {\r\n  const viewModel = useDICreate(PlotEditorViewModel);\r\n  const baseRegistry = useDIDependency(PotionBaseRegistry);\r\n  const map = baseRegistry.getPotionBaseById(\"water\" as any)?.map;\r\n  const inspectPoint = useObservation(viewModel.bottlePreviewPoint$) ?? null;\r\n  const inspectSource = useObservation(viewModel.mouseOverPlotItem$) ?? null;\r\n  const inspectEntity = useObservation(viewModel.mouseOverEntity$) ?? null;\r\n  const scale = useObservation(viewModel.viewScale$) ?? 1;\r\n\r\n  const builder = viewModel.builder;\r\n\r\n  const plot = useObservation(builder.plot$, { useTransition: false }) ?? null;\r\n\r\n  const highlightItem = useObservation(viewModel.mouseOverBuilderItem$) ?? null;\r\n  const outputShareString =\r\n    useObservation(viewModel.shareString$, { useTransition: true }) ?? null;\r\n\r\n  const mouseWorld = useObservation(viewModel.mouseWorldPosition$) ?? null;\r\n\r\n  React.useEffect(() => {\r\n    const query = new URLSearchParams(window.location.search);\r\n    if (query.has(\"data\")) {\r\n      const data = query.get(\"data\")!;\r\n      builder.loadFromShareString(data);\r\n    }\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    if (!outputShareString) {\r\n      return;\r\n    }\r\n    const query = new URLSearchParams(window.location.search);\r\n    query.set(\"data\", outputShareString);\r\n    window.history.replaceState({}, \"\", `?${query.toString()}`);\r\n  }, [outputShareString]);\r\n\r\n  const onBuildItemMouseOver = React.useCallback(\r\n    (item: PlotBuilderItem) => {\r\n      viewModel.onMouseOverBuilderItem(item);\r\n    },\r\n    [viewModel]\r\n  );\r\n\r\n  const onBuildItemMouseOut = React.useCallback(() => {\r\n    viewModel.onMouseOverBuilderItem(null);\r\n  }, [viewModel]);\r\n\r\n  return (\r\n    <Root>\r\n      <div className=\"outer-container\">\r\n        <PanZoomViewport className=\"plot-container\" viewModel={viewModel}>\r\n          {map && <PotionMap className=\"map\" map={map} viewModel={viewModel} />}\r\n          <Plot\r\n            className=\"plot\"\r\n            plot={plot ?? EmptyPlotResult}\r\n            viewModel={viewModel}\r\n          />\r\n        </PanZoomViewport>\r\n        <div className=\"inspect-stack\">\r\n          {inspectPoint && <PointDetails point={inspectPoint} />}\r\n          {inspectSource && <StepDetails step={inspectSource} />}\r\n          {!inspectSource && inspectEntity && (\r\n            <EntityDetails entity={inspectEntity} />\r\n          )}\r\n        </div>\r\n        {plot && <PlotDetails className=\"plot-details\" plot={plot} />}\r\n        {mouseWorld && (\r\n          <Card className=\"mouse-coords\">\r\n            <CardContent>\r\n              <Typography variant=\"overline\">\r\n                ({mouseWorld.x.toFixed(2)}, {mouseWorld.y.toFixed(2)})\r\n              </Typography>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n        <IncDecSlider\r\n          className=\"zoom\"\r\n          value={scale}\r\n          rate={4}\r\n          onChange={(value) => viewModel.setZoom(value)}\r\n        />\r\n      </div>\r\n      <div className=\"divider\" />\r\n      <PlotBuilderItemsList\r\n        className=\"plot-items\"\r\n        builder={builder}\r\n        highlightItem={highlightItem}\r\n        onMouseOver={onBuildItemMouseOver}\r\n        onMouseOut={onBuildItemMouseOut}\r\n      />\r\n    </Root>\r\n  );\r\n};\r\n\r\nexport default PlotEditor;\r\n","import {\r\n  BehaviorSubject,\r\n  map,\r\n  Observable,\r\n  combineLatest,\r\n  debounceTime,\r\n} from \"rxjs\";\r\nimport { first } from \"lodash\";\r\n\r\nimport { inject } from \"microinject\";\r\n\r\nimport {\r\n  Point,\r\n  pointAdd,\r\n  pointDistance,\r\n  pointSubtract,\r\n  PointZero,\r\n} from \"@/points\";\r\nimport { Size, SizeZero } from \"@/size\";\r\n\r\nimport { MAP_EXTENT_RADIUS } from \"@/game-settings\";\r\n\r\nimport { PlotBuilder, PlotBuilderItem } from \"@/services/plotter/PlotBuilder\";\r\nimport { PlotItem, PlotPoint } from \"@/services/plotter/types\";\r\nimport { MapEntity } from \"@/services/potion-maps/types\";\r\n\r\nimport { IPlotViewModel } from \"../Plot/PlotViewModel\";\r\nimport { IPanZoomViewportViewModel } from \"../PanZoomViewport/PanZoomViewportViewModel\";\r\n\r\nexport class PlotEditorViewModel\r\n  implements IPlotViewModel, IPanZoomViewportViewModel\r\n{\r\n  private readonly _viewportSize$ = new BehaviorSubject<Size>(SizeZero);\r\n\r\n  /**\r\n   * The offset of the map on the viewport, in map units, unscaled.\r\n   */\r\n  private readonly _viewOffset$ = new BehaviorSubject<Point>(PointZero);\r\n  private readonly _viewScale$ = new BehaviorSubject<number>(1);\r\n\r\n  private readonly _shareString$: Observable<string>;\r\n\r\n  private readonly _mouseClientPosition$ = new BehaviorSubject<Point | null>(\r\n    null\r\n  );\r\n  private readonly _mouseWorldPosition$: Observable<Point | null>;\r\n  private readonly _mouseOverPlotItem$ = new BehaviorSubject<PlotItem | null>(\r\n    null\r\n  );\r\n  private readonly _mouseOverBuilderItem$ =\r\n    new BehaviorSubject<PlotBuilderItem | null>(null);\r\n  private readonly _mouseOverEntity$: Observable<MapEntity | null>;\r\n\r\n  private readonly _bottlePreviewPoint$: Observable<PlotPoint | null>;\r\n\r\n  constructor(@inject(PlotBuilder) private readonly _builder: PlotBuilder) {\r\n    this._shareString$ = this._builder.plot$\r\n      .pipe(debounceTime(1000))\r\n      .pipe(map((x) => _builder.getShareString()));\r\n\r\n    this._mouseWorldPosition$ = combineLatest([\r\n      this._mouseClientPosition$,\r\n      this._viewOffset$,\r\n      this._viewScale$,\r\n    ]).pipe(\r\n      map(([clientPos]) => (clientPos ? this._clientToWorld(clientPos) : null))\r\n    );\r\n\r\n    this._mouseOverEntity$ = combineLatest([\r\n      this._mouseWorldPosition$,\r\n      _builder.map$,\r\n    ]).pipe(\r\n      map(([worldPos, map]) => {\r\n        if (!worldPos || !map) {\r\n          return null;\r\n        }\r\n\r\n        const entities = map.hitTest(worldPos) ?? [];\r\n        const entity = first(entities);\r\n        return entity ?? null;\r\n      })\r\n    );\r\n\r\n    this._bottlePreviewPoint$ = combineLatest([\r\n      this._mouseWorldPosition$,\r\n      this._mouseOverPlotItem$,\r\n      this._builder.plot$,\r\n    ]).pipe(\r\n      map(([worldPos, plotItem, plot]) => {\r\n        if (!worldPos || !plotItem || !plot) {\r\n          return null;\r\n        }\r\n\r\n        const plotPoints = plot.committedPoints.concat(plot.pendingPoints);\r\n        const plotItemPoints = plotPoints.filter((x) => x.source === plotItem);\r\n\r\n        let closestPlotItem = first(plotItemPoints);\r\n        if (!closestPlotItem) {\r\n          return null;\r\n        }\r\n\r\n        for (let i = 1; i < plotItemPoints.length; i++) {\r\n          const point = plotItemPoints[i];\r\n          if (\r\n            pointDistance(worldPos, point) <\r\n            pointDistance(worldPos, closestPlotItem)\r\n          ) {\r\n            closestPlotItem = point;\r\n          }\r\n        }\r\n\r\n        return closestPlotItem;\r\n      })\r\n    );\r\n  }\r\n\r\n  get builder(): PlotBuilder {\r\n    return this._builder;\r\n  }\r\n\r\n  get shareString$(): Observable<string> {\r\n    return this._shareString$;\r\n  }\r\n\r\n  get viewportSize$(): Observable<Size> {\r\n    return this._viewportSize$;\r\n  }\r\n\r\n  get viewOffset$(): Observable<Point> {\r\n    return this._viewOffset$;\r\n  }\r\n  get viewScale$(): Observable<number> {\r\n    return this._viewScale$;\r\n  }\r\n\r\n  get mouseWorldPosition$(): Observable<Point | null> {\r\n    return this._mouseWorldPosition$;\r\n  }\r\n\r\n  get mouseOverPlotItem$(): Observable<PlotItem | null> {\r\n    return this._mouseOverPlotItem$;\r\n  }\r\n\r\n  get mouseOverBuilderItem$(): Observable<PlotBuilderItem | null> {\r\n    return this._mouseOverBuilderItem$;\r\n  }\r\n\r\n  get mouseOverEntity$(): Observable<MapEntity | null> {\r\n    return this._mouseOverEntity$;\r\n  }\r\n\r\n  get bottlePreviewPoint$(): Observable<PlotPoint | null> {\r\n    return this._bottlePreviewPoint$;\r\n  }\r\n\r\n  zoom(delta: number, on: Point | null = null) {\r\n    const prevWorld = on ? this._clientToWorld(on) : PointZero;\r\n    const pzoom = this._viewScale$.value;\r\n    const zoom = pzoom * delta;\r\n    this._viewScale$.next(zoom);\r\n    if (on) {\r\n      const world = this._clientToWorld(on);\r\n      const delta = pointSubtract(world, prevWorld);\r\n      this._viewOffset$.next(pointAdd(this._viewOffset$.value, delta));\r\n    }\r\n  }\r\n\r\n  setZoom(zoom: number) {\r\n    const delta = zoom / this._viewScale$.value;\r\n    const { width, height } = this._viewportSize$.value;\r\n    this.zoom(delta, { x: width / 2, y: height / 2 });\r\n  }\r\n\r\n  pan(dx: number, dy: number, applyZoom = false) {\r\n    const z = applyZoom ? 1 / this._viewScale$.value : 1;\r\n    this._viewOffset$.next(\r\n      pointAdd(this._viewOffset$.value, { x: dx * z, y: dy * z })\r\n    );\r\n  }\r\n\r\n  onMouseMove(clientX: number, clientY: number): void {\r\n    this._mouseClientPosition$.next({ x: clientX, y: clientY });\r\n  }\r\n\r\n  onMouseOut() {\r\n    this._mouseClientPosition$.next(null);\r\n  }\r\n\r\n  onViewportResized(width: number, height: number): void {\r\n    let prevSize = this._viewportSize$.value;\r\n    if (prevSize.width === 0 || prevSize.height === 0) {\r\n      prevSize = {\r\n        width: MAP_EXTENT_RADIUS * 2,\r\n        height: MAP_EXTENT_RADIUS * 2,\r\n      };\r\n    }\r\n\r\n    this._viewportSize$.next({ width, height });\r\n\r\n    if (width === 0 || height === 0) {\r\n      return;\r\n    }\r\n\r\n    let scaleFactor = 1;\r\n    if (width < height) {\r\n      scaleFactor = width / prevSize.width;\r\n    } else {\r\n      scaleFactor = height / prevSize.height;\r\n    }\r\n\r\n    // TODO: Keep the view centered.\r\n    // const offset: Point = {\r\n    //   x: (prevSize.width - width) / 2 / this._viewScale$.value,\r\n    //   y: (prevSize.height - height) / 2 / this._viewScale$.value,\r\n    // };\r\n    this._viewScale$.next(this._viewScale$.value * scaleFactor);\r\n    // this._viewOffset$.next(pointAdd(this._viewOffset$.value, offset));\r\n  }\r\n\r\n  onMouseOverPlotItem(item: PlotItem | null): void {\r\n    this._mouseOverPlotItem$.next(item);\r\n    this._mouseOverBuilderItem$.next(\r\n      item ? this._builder.builderItemFor(item) : null\r\n    );\r\n  }\r\n\r\n  onMouseOverBuilderItem(item: PlotBuilderItem | null): void {\r\n    this._mouseOverBuilderItem$.next(item);\r\n    this._mouseOverPlotItem$.next(item ? item.plotItem : null);\r\n  }\r\n\r\n  private _clientToWorld(p: Point): Point {\r\n    const zoomFactor = this._viewScale$.value;\r\n    const { x: offsetX, y: offsetY } = this._viewOffset$.value;\r\n\r\n    // offset is in world coords.\r\n    // We need to add offsetY instead of subtract as y is flipped in world coords when compared to screen.\r\n    return {\r\n      x: p.x / zoomFactor - MAP_EXTENT_RADIUS - offsetX,\r\n      y: (p.y / zoomFactor - MAP_EXTENT_RADIUS + offsetY) * -1,\r\n    };\r\n  }\r\n\r\n  private _worldToClient(p: Point): Point {\r\n    const zoomFactor = this._viewScale$.value;\r\n    const { x: offsetX, y: offsetY } = this._viewOffset$.value;\r\n\r\n    // Why the hell is this opposite of crucible-web even with the same client to world coord function?\r\n    return {\r\n      x: (p.x + MAP_EXTENT_RADIUS + offsetX) * zoomFactor,\r\n      y: (-p.y + MAP_EXTENT_RADIUS + offsetY) * zoomFactor,\r\n    };\r\n  }\r\n}\r\n","import React from \"react\";\r\n\r\nimport { Card, CardContent } from \"@mui/material\";\r\n\r\nimport {\r\n  MapEntity,\r\n  PotionEffectMapEntity,\r\n  VortexMapEntity,\r\n} from \"@/services/potion-maps/types\";\r\n\r\nexport interface StepDetailsProps {\r\n  className?: string;\r\n  entity: MapEntity;\r\n}\r\n\r\nconst EntityDetails = ({ entity, className }: StepDetailsProps) => {\r\n  let content: React.ReactNode;\r\n  switch (entity.entityType) {\r\n    case \"PotionEffect\":\r\n      content = <PotionEffectMapEntityDetails entity={entity} />;\r\n      break;\r\n    case \"Vortex\":\r\n      content = <VortexMapEntityDetails entity={entity} />;\r\n      break;\r\n    default:\r\n      return null;\r\n  }\r\n\r\n  return (\r\n    <Card className={className} variant=\"outlined\">\r\n      <CardContent>{content}</CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default EntityDetails;\r\n\r\nconst PotionEffectMapEntityDetails = ({\r\n  entity,\r\n}: {\r\n  entity: PotionEffectMapEntity;\r\n}) => {\r\n  return (\r\n    <div>\r\n      {entity.effect} ({entity.x}, {entity.y})\r\n    </div>\r\n  );\r\n};\r\n\r\nconst VortexMapEntityDetails = ({ entity }: { entity: VortexMapEntity }) => {\r\n  return (\r\n    <div>\r\n      Vortex ({entity.x}, {entity.y})\r\n    </div>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { uniq, sum, clamp, last } from \"lodash\";\r\n\r\nimport { Card, CardContent, Typography } from \"@mui/material\";\r\n\r\nimport { useDIDependency } from \"@/container\";\r\nimport { pointArrayLength } from \"@/point-array\";\r\nimport { pointMagnitude, pointSubtract, PointZero } from \"@/points\";\r\n\r\nimport {\r\n  AddIngredientPlotItem,\r\n  PlotItem,\r\n  PlotPoint,\r\n  PlotResult,\r\n} from \"@/services/plotter/types\";\r\nimport { IngredientRegistry } from \"@/services/ingredients/IngredientRegistry\";\r\nimport { MapEntity, PotionEffectMapEntity } from \"@/services/potion-maps/types\";\r\n\r\nexport interface PlotDetailsProps {\r\n  className?: string;\r\n  plot: PlotResult;\r\n}\r\n\r\nconst PlotDetails = ({ className, plot }: PlotDetailsProps) => {\r\n  const ingredientRegistry = useDIDependency(IngredientRegistry);\r\n\r\n  const endsAt = last(plot.committedPoints) ?? PointZero;\r\n\r\n  const [\r\n    effects,\r\n    baseCost,\r\n    length,\r\n    totalIngredients,\r\n    totalUniqueIngredients,\r\n    stress,\r\n    longestDanger,\r\n  ] = React.useMemo(() => {\r\n    const allPoints = plot.committedPoints.concat(plot.pendingPoints);\r\n    const sources = uniq(allPoints.map((point) => point.source));\r\n    const ingredients = sources.filter(isIngredientPoint);\r\n\r\n    const effects = getEffects(plot.committedPoints);\r\n\r\n    let baseCost = 0;\r\n    let ingredientTypeCounts: Record<string, number> = {};\r\n    for (const { ingredientId } of ingredients) {\r\n      const ingredient = ingredientRegistry.getIngredientById(ingredientId);\r\n      if (!ingredient) {\r\n        continue;\r\n      }\r\n      baseCost += ingredient.price;\r\n      ingredientTypeCounts[ingredient.id] =\r\n        (ingredientTypeCounts[ingredient.id] ?? 0) + 1;\r\n    }\r\n\r\n    const length = pointArrayLength(plot.committedPoints);\r\n\r\n    const totalIngredients = ingredients.length;\r\n    const totalUniqueIngredients = uniq(\r\n      ingredients.map((x) => x.ingredientId)\r\n    ).length;\r\n\r\n    const stress = Math.sqrt(\r\n      sum(\r\n        Object.keys(ingredientTypeCounts).map((key) =>\r\n          Math.pow(ingredientTypeCounts[key], 2)\r\n        )\r\n      )\r\n    );\r\n\r\n    const longestDanger = longestDangerLength(plot.committedPoints);\r\n\r\n    return [\r\n      effects,\r\n      baseCost,\r\n      length,\r\n      totalIngredients,\r\n      totalUniqueIngredients,\r\n      stress,\r\n      longestDanger,\r\n    ];\r\n  }, [plot, IngredientRegistry]);\r\n\r\n  return (\r\n    <Card className={className} variant=\"outlined\">\r\n      <CardContent>\r\n        <Typography variant=\"h6\">Details</Typography>\r\n        <table>\r\n          <tbody>\r\n            <tr>\r\n              <td>\r\n                <Typography>Effects:</Typography>\r\n              </td>\r\n              <td>\r\n                <Typography variant=\"overline\">\r\n                  {Object.keys(effects)\r\n                    .map((effect) => `${effect} (${effects[effect]})`)\r\n                    .join(\", \")}\r\n                </Typography>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <Typography>Ingredient count:</Typography>\r\n              </td>\r\n              <td>\r\n                <Typography variant=\"overline\">\r\n                  {totalIngredients} ({totalUniqueIngredients} unique)\r\n                </Typography>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <Typography>Ingredient stress:</Typography>\r\n              </td>\r\n              <td>\r\n                <Typography variant=\"overline\">{stress.toFixed(2)}</Typography>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <Typography>Base Cost:</Typography>\r\n              </td>\r\n              <td>\r\n                <Typography variant=\"overline\">{baseCost}</Typography>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <Typography>Committed length:</Typography>\r\n              </td>\r\n              <td>\r\n                <Typography variant=\"overline\">{length.toFixed(2)}</Typography>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <Typography>Ends at:</Typography>\r\n              </td>\r\n              <td>\r\n                <Typography variant=\"overline\">\r\n                  {endsAt.x.toFixed(2)}, {endsAt.y.toFixed(2)}\r\n                </Typography>\r\n              </td>\r\n            </tr>\r\n            <tr>\r\n              <td>\r\n                <Typography>Longest length in bones:</Typography>\r\n              </td>\r\n              <td>\r\n                <Typography variant=\"overline\">\r\n                  {longestDanger.toFixed(2)}\r\n                </Typography>\r\n              </td>\r\n            </tr>\r\n          </tbody>\r\n        </table>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default PlotDetails;\r\n\r\nexport function isIngredientPoint(\r\n  point: PlotItem\r\n): point is AddIngredientPlotItem {\r\n  return point.type === \"add-ingredient\";\r\n}\r\n\r\nfunction longestDangerLength(items: PlotPoint[]): number {\r\n  let longestLength = 0;\r\n  let currentLength = 0;\r\n  let prevItem = items[0];\r\n  for (let i = 1; i < items.length; i++) {\r\n    const item = items[i];\r\n    if (item.entities.some((x) => x.entityType === \"DangerZonePart\")) {\r\n      currentLength += pointMagnitude(pointSubtract(item, prevItem));\r\n    } else {\r\n      longestLength = Math.max(longestLength, currentLength);\r\n      currentLength = 0;\r\n    }\r\n    prevItem = item;\r\n  }\r\n\r\n  return Math.max(longestLength, currentLength);\r\n}\r\n\r\nfunction getEffects(items: PlotPoint[]): Record<string, number> {\r\n  const result: Record<string, number> = {};\r\n  for (const item of items) {\r\n    const effect = item.entities.find(itemIsEffect);\r\n    if (!effect) {\r\n      continue;\r\n    }\r\n\r\n    const distance = pointMagnitude(pointSubtract(item, effect));\r\n    const tier = getEffectTier(distance, 0);\r\n    result[effect.effect] = Math.max(result[effect.effect] ?? 0, tier);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction itemIsEffect(item: MapEntity): item is PotionEffectMapEntity {\r\n  return item.entityType === \"PotionEffect\";\r\n}\r\n\r\nfunction getEffectTier(distance: number, angleDegreesDelta: number): number {\r\n  // From RecipeMapManager.GetEffectTier()\r\n  const middleEffectPowerPosition = 0.9;\r\n  const effectPowerDistanceDependence = (value: number) => {\r\n    return -0.36 * value + 0.72;\r\n  };\r\n  const effectPowerAngleDependence = (value: number) => {\r\n    // TODO: angle\r\n    // We know its 0.3 at the perfect angle.\r\n    return 0.3;\r\n  };\r\n\r\n  const value = clamp(\r\n    effectPowerDistanceDependence(distance) +\r\n      effectPowerAngleDependence(angleDegreesDelta),\r\n    0,\r\n    1\r\n  );\r\n  if (value < middleEffectPowerPosition) {\r\n    return 1;\r\n  }\r\n  return !(Math.abs(value - 1) < Number.EPSILON) ? 2 : 3;\r\n}\r\n","import React from \"react\";\r\n\r\nimport { Card, CardContent, Typography } from \"@mui/material\";\r\n\r\nimport { uniq } from \"lodash\";\r\n\r\nimport { EntityDefs } from \"@/services/potion-maps/entity-defs\";\r\n\r\nimport { PlotPoint } from \"@/services/plotter/types\";\r\n\r\nexport interface PointDetailsProps {\r\n  point: PlotPoint;\r\n}\r\n\r\nconst PointDetails = ({ point }: PointDetailsProps) => {\r\n  const touchedItems = uniq(\r\n    point.entities.map((x) => EntityDefs[x.entityType].getFriendlyName(x))\r\n  );\r\n  return (\r\n    <Card variant=\"outlined\">\r\n      <CardContent>\r\n        <Typography variant=\"h6\">Point at mouse</Typography>\r\n        <Typography variant=\"overline\">\r\n          {point.x.toFixed(2)}, {point.y.toFixed(2)}\r\n        </Typography>\r\n        {touchedItems.length > 0 && (\r\n          <>\r\n            <Typography>Bottle touches:</Typography>\r\n            <Typography variant=\"overline\">\r\n              {touchedItems.join(\", \")}\r\n            </Typography>\r\n          </>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default PointDetails;\r\n","import React from \"react\";\r\n\r\nimport { Card, CardContent, Typography, styled } from \"@mui/material\";\r\n\r\nimport { useDIDependency } from \"@/container\";\r\n\r\nimport { CubicBezierCurve } from \"@/curves\";\r\nimport { MAX_INGREDIENT_EXTENT, POTION_RADIUS } from \"@/game-settings\";\r\n\r\nimport { AddIngredientPlotItem, PlotItem } from \"@/services/plotter/types\";\r\nimport { IngredientRegistry } from \"@/services/ingredients/IngredientRegistry\";\r\n\r\nexport interface StepDetailsProps {\r\n  className?: string;\r\n  step: PlotItem;\r\n}\r\n\r\nconst StepDetails = ({ step, className }: StepDetailsProps) => {\r\n  let content: React.ReactNode;\r\n  switch (step.type) {\r\n    case \"add-ingredient\":\r\n      content = <AddIngredient step={step} />;\r\n      break;\r\n    default:\r\n      return null;\r\n  }\r\n\r\n  return (\r\n    <Card className={className} variant=\"outlined\">\r\n      <CardContent>{content}</CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\ninterface AddIngredientStepProps {\r\n  step: AddIngredientPlotItem;\r\n}\r\n\r\nconst AddIngredientRoot = styled(\"div\")({\r\n  \"& .svg-container\": {\r\n    width: \"100%\",\r\n    height: \"100%\",\r\n    display: \"flex\",\r\n    justifyContent: \"center\",\r\n    alignItems: \"center\",\r\n  },\r\n});\r\nconst AddIngredient = ({ step }: AddIngredientStepProps) => {\r\n  const ingredientRegistry = useDIDependency(IngredientRegistry);\r\n  const ingredient = ingredientRegistry.getIngredientById(\r\n    step.ingredientId\r\n  ) ?? {\r\n    name: \"Unknown\",\r\n    path: [] as CubicBezierCurve[],\r\n  };\r\n\r\n  const path = ingredient.path.reduce(\r\n    (path, curve) =>\r\n      path +\r\n      `M ${curve.start.x} ${curve.start.y} C ${curve.p1.x},${curve.p1.y} ${curve.p2.x},${curve.p2.y} ${curve.end.x},${curve.end.y}`,\r\n    \"M 0 0 \"\r\n  );\r\n  return (\r\n    <AddIngredientRoot>\r\n      <Typography variant=\"h6\">Ingredient</Typography>\r\n      <Typography variant=\"overline\">{ingredient.name}</Typography>\r\n      <div>\r\n        <Typography>Grind Percentage</Typography>\r\n        <Typography variant=\"overline\">{step.grindPercent}</Typography>\r\n      </div>\r\n      <div className=\"svg-container\">\r\n        <svg\r\n          width=\"100px\"\r\n          height=\"100px\"\r\n          viewBox={`-${MAX_INGREDIENT_EXTENT} -${MAX_INGREDIENT_EXTENT} ${\r\n            MAX_INGREDIENT_EXTENT * 2\r\n          } ${MAX_INGREDIENT_EXTENT * 2}`}\r\n          transform=\"scale(1, -1)\"\r\n        >\r\n          <circle cx={0} cy={0} r={POTION_RADIUS} fill=\"blue\" />\r\n          <path d={path} stroke=\"black\" strokeWidth={0.2} fill=\"none\" />\r\n        </svg>\r\n      </div>\r\n    </AddIngredientRoot>\r\n  );\r\n};\r\n\r\nexport default StepDetails;\r\n","import PlotEditor from \"./PlotEditor\";\r\nexport default PlotEditor;\r\n","import React from \"react\";\r\nimport Color from \"color\";\r\nimport { styled } from \"@mui/material\";\r\n\r\nimport { useObservation } from \"@/hooks/observe\";\r\nimport { PointZero } from \"@/points\";\r\nimport { MAP_EXTENT_RADIUS, POTION_RADIUS } from \"@/game-settings\";\r\nimport { PointArray } from \"@/point-array\";\r\nimport { keepEveryK } from \"@/utils\";\r\n\r\nimport { PlotItem, PlotPoint, PlotResult } from \"@/services/plotter/types\";\r\nimport {\r\n  IPlotViewModel,\r\n  PlotViewModelContext,\r\n  usePlotViewModel,\r\n} from \"./PlotViewModel\";\r\n\r\nimport { SizeZero } from \"@/size\";\r\nimport { last } from \"lodash\";\r\n\r\nexport interface PlotProps {\r\n  className?: string;\r\n  plot: PlotResult;\r\n  viewModel: IPlotViewModel;\r\n}\r\n\r\nconst Root = styled(\"div\")(({ theme }) => ({\r\n  overflow: \"hidden\",\r\n  position: \"relative\",\r\n  \"& .plot-svg\": {\r\n    display: \"block\",\r\n    position: \"absolute\",\r\n    left: 0,\r\n    top: 0,\r\n  },\r\n  \"& .bottle-preview\": {\r\n    pointerEvents: \"none\",\r\n  },\r\n}));\r\n\r\nconst Plot = ({ className, plot, viewModel }: PlotProps) => {\r\n  const { width, height } = useObservation(viewModel.viewportSize$) ?? SizeZero;\r\n  const offset = useObservation(viewModel.viewOffset$) ?? PointZero;\r\n  const scale = useObservation(viewModel.viewScale$) ?? 1;\r\n  const inspectSource = useObservation(viewModel.mouseOverPlotItem$) ?? null;\r\n  const bottlePreviewPoint =\r\n    useObservation(viewModel.bottlePreviewPoint$) ?? null;\r\n\r\n  const onLineMouseOver = React.useCallback(\r\n    (line: PlotLine) => {\r\n      viewModel.onMouseOverPlotItem(line.source);\r\n    },\r\n    [viewModel]\r\n  );\r\n\r\n  const onLineMouseOut = React.useCallback(() => {\r\n    () => viewModel.onMouseOverPlotItem(null);\r\n  }, [viewModel]);\r\n\r\n  const [committedLines, pendingLines] = resultToPlotLines(\r\n    plot.committedPoints,\r\n    plot.pendingPoints\r\n  );\r\n\r\n  return (\r\n    <Root className={className}>\r\n      <PlotViewModelContext.Provider value={viewModel}>\r\n        <svg\r\n          className=\"plot-svg\"\r\n          width={width}\r\n          height={height}\r\n          viewBox={`0 0 ${width} ${height}`}\r\n        >\r\n          {/* In theory all these transforms can be done in one go, but neither order seems to work when combining them */}\r\n          <g transform={`scale(${scale})`}>\r\n            <g\r\n              transform={`translate(${MAP_EXTENT_RADIUS}, ${MAP_EXTENT_RADIUS})`}\r\n            >\r\n              <g transform=\"scale(1, -1)\">\r\n                <g transform={`translate(${offset.x}, ${offset.y})`}>\r\n                  {committedLines.map((line, i) => (\r\n                    <PlotLine\r\n                      key={i}\r\n                      line={line}\r\n                      pending={false}\r\n                      highlight={line.source === inspectSource}\r\n                      onMouseOver={onLineMouseOver}\r\n                      onMouseOut={onLineMouseOut}\r\n                    />\r\n                  ))}\r\n                  {pendingLines.map((line, i) => (\r\n                    <PlotLine\r\n                      key={i}\r\n                      line={line}\r\n                      pending={true}\r\n                      highlight={line.source === inspectSource}\r\n                      onMouseOver={onLineMouseOver}\r\n                      onMouseOut={onLineMouseOut}\r\n                    />\r\n                  ))}\r\n                  {bottlePreviewPoint && (\r\n                    <circle\r\n                      className=\"bottle-preview\"\r\n                      cx={bottlePreviewPoint.x}\r\n                      cy={bottlePreviewPoint.y}\r\n                      r={POTION_RADIUS}\r\n                      fill=\"blue\"\r\n                      opacity={0.2}\r\n                    />\r\n                  )}\r\n                </g>\r\n              </g>\r\n            </g>\r\n          </g>\r\n        </svg>\r\n      </PlotViewModelContext.Provider>\r\n    </Root>\r\n  );\r\n};\r\n\r\ninterface PlotLineProps {\r\n  line: PlotLine;\r\n  pending: boolean;\r\n  highlight: boolean;\r\n  onMouseOver(line: PlotLine): void;\r\n  onMouseOut(): void;\r\n}\r\nconst PlotLine = ({\r\n  line,\r\n  pending,\r\n  highlight,\r\n  onMouseOver,\r\n  onMouseOut,\r\n}: PlotLineProps) => {\r\n  const viewModel = usePlotViewModel();\r\n  const scale = useObservation(viewModel.viewScale$) ?? 1;\r\n  const { points, source, evenOdd } = line;\r\n\r\n  const lastPoint = last(points) ?? PointZero;\r\n\r\n  const onPathMouseOver = React.useCallback(() => {\r\n    onMouseOver(line);\r\n  }, [line, onMouseOver]);\r\n\r\n  const onPathMouseOut = React.useCallback(() => {\r\n    onMouseOut();\r\n  }, []);\r\n\r\n  if (points.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  let color = \"black\";\r\n  switch (source.type) {\r\n    case \"add-ingredient\":\r\n      color = evenOdd ? \"red\" : \"green\";\r\n      break;\r\n    case \"pour-solvent\":\r\n      color = \"blue\";\r\n      break;\r\n    case \"heat-vortex\":\r\n      color = \"purple\";\r\n      break;\r\n  }\r\n\r\n  if (pending) {\r\n    color = Color(color).lighten(0.4).hex();\r\n  }\r\n\r\n  const path = line.points.reduce(\r\n    (str, p) => `${str} L${p.x},${p.y}`,\r\n    `M ${points[0].x} ${points[0].y} `\r\n  );\r\n\r\n  return (\r\n    <path\r\n      d={path}\r\n      stroke={color}\r\n      strokeWidth={(highlight ? 6 : 3) / scale}\r\n      fill=\"none\"\r\n      onMouseOver={onPathMouseOver}\r\n      onMouseOut={onPathMouseOut}\r\n    />\r\n  );\r\n};\r\n\r\ninterface PlotLine {\r\n  points: PointArray;\r\n  source: PlotItem;\r\n  evenOdd: boolean;\r\n}\r\n\r\nfunction resultToPlotLines(\r\n  committed: PlotPoint[],\r\n  pending: PlotPoint[],\r\n  trim = 4\r\n) {\r\n  let currentLine: PlotLine | null = null;\r\n  let sourceCounter = 0;\r\n\r\n  const commitedLines: PlotLine[] = [];\r\n  const pendingLines: PlotLine[] = [];\r\n\r\n  let lastSource: PlotItem | null = null;\r\n\r\n  for (const point of committed) {\r\n    if (currentLine == null || currentLine.source != point.source) {\r\n      if (lastSource == null || lastSource !== point.source) {\r\n        sourceCounter++;\r\n        lastSource = point.source;\r\n      }\r\n      currentLine = {\r\n        points: [],\r\n        source: point.source,\r\n        evenOdd: sourceCounter % 2 === 1,\r\n      };\r\n      commitedLines.push(currentLine);\r\n    }\r\n\r\n    currentLine.points.push(point);\r\n  }\r\n\r\n  currentLine = null;\r\n\r\n  for (const point of pending) {\r\n    if (currentLine == null || currentLine.source != point.source) {\r\n      if (lastSource == null || lastSource !== point.source) {\r\n        sourceCounter++;\r\n        lastSource = point.source;\r\n      }\r\n      currentLine = {\r\n        points: [],\r\n        source: point.source,\r\n        evenOdd: sourceCounter % 2 === 1,\r\n      };\r\n      pendingLines.push(currentLine);\r\n    }\r\n\r\n    currentLine.points.push(point);\r\n  }\r\n\r\n  if (trim > 1) {\r\n    for (const line of commitedLines) {\r\n      line.points = keepEveryK(line.points, trim, true);\r\n    }\r\n    for (const line of pendingLines) {\r\n      line.points = keepEveryK(line.points, trim, true);\r\n    }\r\n  }\r\n\r\n  return [commitedLines, pendingLines];\r\n}\r\n\r\nexport default Plot;\r\n","import React from \"react\";\r\nimport { BehaviorSubject, Observable } from \"rxjs\";\r\n\r\nimport {\r\n  Point,\r\n  pointAdd,\r\n  pointScale,\r\n  pointSubtract,\r\n  PointZero,\r\n} from \"@/points\";\r\nimport { MAP_EXTENT_RADIUS } from \"@/game-settings\";\r\nimport { PlotItem, PlotPoint } from \"@/services/plotter/types\";\r\nimport { Size } from \"@/size\";\r\n\r\nexport const PlotViewModelContext = React.createContext<IPlotViewModel | null>(\r\n  null\r\n);\r\n\r\nexport function usePlotViewModel(): IPlotViewModel {\r\n  const plotViewModel = React.useContext(PlotViewModelContext);\r\n  if (!plotViewModel) {\r\n    throw new Error(\"PlotViewModelContext not found\");\r\n  }\r\n  return plotViewModel;\r\n}\r\n\r\nexport interface IPlotViewModel {\r\n  readonly viewportSize$: Observable<Size>;\r\n  readonly viewOffset$: Observable<Point>;\r\n  readonly viewScale$: Observable<number>;\r\n  readonly mouseOverPlotItem$: Observable<PlotItem | null>;\r\n  readonly bottlePreviewPoint$: Observable<PlotPoint | null>;\r\n\r\n  onMouseOverPlotItem(item: PlotItem | null): void;\r\n}\r\n","import Plot from \"./Plot\";\r\nexport default Plot;\r\n","import React from \"react\";\r\nimport {\r\n  composeModules,\r\n  Container,\r\n  Identifier,\r\n  Newable,\r\n  ParameterRecord,\r\n} from \"microinject\";\r\n\r\nimport servicesModule from \"./services/module\";\r\n\r\nconst modules = composeModules(servicesModule);\r\n\r\nconst ContainerContext = React.createContext<Container>(new Container());\r\n\r\nconst container = new Container();\r\ncontainer.bind(Container).toConstantValue(container);\r\ncontainer.load(modules);\r\n\r\nexport default container;\r\n\r\nexport interface ContainerProviderProps {\r\n  children: React.ReactNode;\r\n}\r\nexport const ContainerProvider = ({ children }: ContainerProviderProps) => {\r\n  return (\r\n    <ContainerContext.Provider value={container}>\r\n      {children}\r\n    </ContainerContext.Provider>\r\n  );\r\n};\r\n\r\nexport function useDIContainer(): Container {\r\n  return React.useContext(ContainerContext);\r\n}\r\n\r\nexport function useDIDependency<T>(identifier: Identifier<T>): T {\r\n  const container = useDIContainer();\r\n  return container.get(identifier);\r\n}\r\n\r\nexport function useDICreate<T>(\r\n  identifier: Newable<T>,\r\n  parameters?: ParameterRecord\r\n): T {\r\n  const container = useDIContainer();\r\n  const valRef = React.useRef<T>();\r\n  if (valRef.current == null) {\r\n    valRef.current = container.create(identifier, parameters);\r\n  }\r\n  return valRef.current;\r\n}\r\n","import {\r\n  BEZIER_CURVE_LENGTH_RESOLUTION,\r\n  PATH_SPACING_PHYSICS,\r\n} from \"./game-settings\";\r\n\r\nimport {\r\n  Point,\r\n  pointAdd,\r\n  pointDistance,\r\n  pointMagnitude,\r\n  pointNormalize,\r\n  pointScale,\r\n  pointSubtract,\r\n  PointZero,\r\n} from \"./points\";\r\n\r\nexport interface CubicBezierCurve {\r\n  start: Point;\r\n  p1: Point;\r\n  p2: Point;\r\n  end: Point;\r\n}\r\n\r\nexport function cubicBezierCurve(\r\n  startX: number,\r\n  startY: number,\r\n  p1x: number,\r\n  p1y: number,\r\n  p2x: number,\r\n  p2y: number,\r\n  endx: number,\r\n  endy: number\r\n): CubicBezierCurve {\r\n  return {\r\n    start: { x: startX, y: startY },\r\n    p1: { x: p1x, y: p1y },\r\n    p2: { x: p2x, y: p2y },\r\n    end: { x: endx, y: endy },\r\n  };\r\n}\r\n\r\nexport function getCurvePoint(curve: CubicBezierCurve, t: number): Point {\r\n  if (t < 0 || t > 1) {\r\n    throw new Error(\"getPoint: t must be between 0 and 1\");\r\n  }\r\n\r\n  const b1 = (1 - t) * (1 - t) * (1 - t);\r\n  const b2 = 3 * t * (1 - t) * (1 - t);\r\n  const b3 = 3 * t * t * (1 - t);\r\n  const b4 = t * t * t;\r\n\r\n  return {\r\n    x:\r\n      b1 * curve.start.x + b2 * curve.p1.x + b3 * curve.p2.x + b4 * curve.end.x,\r\n    y:\r\n      b1 * curve.start.y + b2 * curve.p1.y + b3 * curve.p2.y + b4 * curve.end.y,\r\n  };\r\n}\r\n\r\nconst curveLengthCache = new Map<CubicBezierCurve, number>();\r\nexport function getCurveLength(\r\n  curve: CubicBezierCurve\r\n  // resolution: number = BEZIER_CURVE_LENGTH_RESOLUTION\r\n): number {\r\n  const resolution = BEZIER_CURVE_LENGTH_RESOLUTION;\r\n  const cached = curveLengthCache.get(curve);\r\n  if (cached !== undefined) {\r\n    return cached;\r\n  }\r\n\r\n  let length = 0.0;\r\n\r\n  let previousPoint = getCurvePoint(curve, 0);\r\n\r\n  for (let index = 1; index <= resolution; index++) {\r\n    const point = getCurvePoint(curve, index / resolution);\r\n    const vector2_2 = pointSubtract(point, previousPoint);\r\n    length += pointMagnitude(vector2_2);\r\n    previousPoint = point;\r\n  }\r\n\r\n  curveLengthCache.set(curve, length);\r\n\r\n  return length;\r\n}\r\n\r\nconst curvePointsCache = new Map<CubicBezierCurve, readonly Point[]>();\r\nexport function curveToPoints(\r\n  curve: CubicBezierCurve\r\n  // spacing: number = PATH_SPACING_PHYSICS,\r\n  // resolution: number = 1\r\n): readonly Point[] {\r\n  const spacing: number = PATH_SPACING_PHYSICS;\r\n  const resolution: number = 1;\r\n\r\n  // if (spacing <= Number.EPSILON) {\r\n  //   throw new Error(\"curveToPoints: spacing must be greater than 0\");\r\n  // }\r\n  // if (resolution <= 0) {\r\n  //   throw new Error(\"curveToPoints: resolution must be greater than 0\");\r\n  // }\r\n\r\n  const cached = curvePointsCache.get(curve);\r\n  if (cached !== undefined) {\r\n    return cached;\r\n  }\r\n\r\n  const points: Point[] = [];\r\n\r\n  let remainingDistance = 0;\r\n  let previousPoint: Point = curve.start;\r\n\r\n  points.push(previousPoint);\r\n\r\n  const samplePointCount = Math.ceil(getCurveLength(curve) * resolution * 10.0);\r\n  for (let index = 0; index <= samplePointCount; index++) {\r\n    const t = index / samplePointCount;\r\n    const point = getCurvePoint(curve, t);\r\n    remainingDistance += pointDistance(previousPoint, point);\r\n    while (remainingDistance >= spacing) {\r\n      remainingDistance = remainingDistance - spacing;\r\n      const splitPoint = pointAdd(\r\n        point,\r\n        pointScale(\r\n          pointNormalize(pointSubtract(previousPoint, point)),\r\n          remainingDistance\r\n        )\r\n      );\r\n      points.push(splitPoint);\r\n      previousPoint = splitPoint;\r\n    }\r\n    previousPoint = point;\r\n  }\r\n\r\n  if (remainingDistance > 0) {\r\n    points.push(getCurvePoint(curve, 1));\r\n  }\r\n\r\n  Object.freeze(points);\r\n  for (const p of points) {\r\n    Object.freeze(p);\r\n  }\r\n  curvePointsCache.set(curve, points);\r\n\r\n  return points;\r\n}\r\n","export const PATH_SPACING_PHYSICS = 0.05;\r\nexport const BEZIER_CURVE_LENGTH_RESOLUTION = 200;\r\nexport const MAP_EXTENT_RADIUS = 60;\r\nexport const POTION_RADIUS = 0.79;\r\nexport const MAX_INGREDIENT_EXTENT = 10;\r\n","import * as React from \"react\";\r\n\r\ninterface UseComponentBounds {\r\n  left: number;\r\n  top: number;\r\n  right: number;\r\n  bottom: number;\r\n  width: number;\r\n  height: number;\r\n}\r\nexport function useComponentBounds(ref: React.RefObject<HTMLElement | null>) {\r\n  const [size, setSize] = React.useState<UseComponentBounds>({\r\n    left: 0,\r\n    top: 0,\r\n    right: 0,\r\n    bottom: 0,\r\n    width: 0,\r\n    height: 0,\r\n  });\r\n\r\n  React.useLayoutEffect(() => {\r\n    if (!ref.current) {\r\n      return;\r\n    }\r\n\r\n    const observer = new ResizeObserver(() => {\r\n      const el = ref.current;\r\n      if (!el) {\r\n        return;\r\n      }\r\n      const b = el.getBoundingClientRect();\r\n      setSize({\r\n        top: b.top,\r\n        left: b.left,\r\n        right: b.right,\r\n        bottom: b.bottom,\r\n        width: b.width,\r\n        height: b.height,\r\n      });\r\n    });\r\n\r\n    observer.observe(ref.current);\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, [ref]);\r\n\r\n  return size;\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport function useNativeEvent<\r\n  T extends GlobalEventHandlers,\r\n  K extends keyof GlobalEventHandlersEventMap\r\n>(\r\n  ref: React.RefObject<T | null>,\r\n  type: K,\r\n  listener: (\r\n    this: GlobalEventHandlers,\r\n    ev: GlobalEventHandlersEventMap[K]\r\n  ) => any,\r\n  options?: boolean | AddEventListenerOptions\r\n) {\r\n  React.useEffect(() => {\r\n    if (!ref.current) {\r\n      return;\r\n    }\r\n\r\n    // De-reference the target so we remove from the right element.\r\n    const listenTarget = ref.current;\r\n\r\n    listenTarget.addEventListener(type, listener, options);\r\n    return () => {\r\n      listenTarget.removeEventListener(type, listener, options);\r\n    };\r\n  }, [type, listener, ref, options]);\r\n}\r\n","import React from \"react\";\r\nimport { Observable } from \"rxjs\";\r\n\r\nexport interface UseObservationOpts {\r\n  useTransition?: boolean;\r\n  onError?: (err: Error) => void;\r\n}\r\nexport function useObservation<T>(\r\n  observable: Observable<T> | T | null | undefined,\r\n  { useTransition, onError }: UseObservationOpts = {}\r\n): T | undefined {\r\n  const [val, setVal] = React.useState<T | undefined>(undefined);\r\n\r\n  React.useEffect(() => {\r\n    if (observable) {\r\n      if (observable instanceof Observable) {\r\n        const subscription = observable.subscribe({\r\n          next: (val) => {\r\n            if (useTransition) {\r\n              React.startTransition(() => setVal(val));\r\n            } else {\r\n              setVal(val);\r\n            }\r\n          },\r\n          error: onError,\r\n        });\r\n        return () => subscription.unsubscribe();\r\n      } else {\r\n        setVal(observable);\r\n      }\r\n    }\r\n  }, [observable, onError, useTransition]);\r\n\r\n  return val;\r\n}\r\n","import \"@/style.css\";\r\n\r\nimport * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom/client\";\r\n\r\nimport { ContainerProvider } from \"./container\";\r\nimport ThemeProvider from \"./theme\";\r\n\r\nimport App from \"./components/App\";\r\n\r\nconst rootEl = document.getElementById(\"root\");\r\nconst root = ReactDOM.createRoot(rootEl!);\r\nroot.render(\r\n  <React.StrictMode>\r\n    <ContainerProvider>\r\n      <ThemeProvider>\r\n        <App />\r\n      </ThemeProvider>\r\n    </ContainerProvider>\r\n  </React.StrictMode>\r\n);\r\n","import { keyboardModifierUseMeta } from \"./runtime-env\";\r\n\r\nexport const MODIFIER_KEYS_NONE = Object.freeze<ModifierKeys>({});\r\n\r\nexport interface ModifierKeys {\r\n  ctrlMetaKey?: boolean;\r\n  shiftKey?: boolean;\r\n  altKey?: boolean;\r\n}\r\n\r\nexport interface MouseEventModifierKeys {\r\n  ctrlKey: boolean;\r\n  altKey: boolean;\r\n  shiftKey: boolean;\r\n  metaKey: boolean;\r\n}\r\nexport function getModifiers(e: MouseEventModifierKeys): ModifierKeys {\r\n  const { ctrlKey, altKey, shiftKey, metaKey } = e;\r\n  return {\r\n    // Mac reserves ctrl for system use, apps use meta.\r\n    ctrlMetaKey: keyboardModifierUseMeta ? metaKey : ctrlKey,\r\n    altKey,\r\n    shiftKey,\r\n  };\r\n}\r\n\r\nexport function isModifierPressed(event: React.MouseEvent<any>) {\r\n  return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);\r\n}\r\n","import { sum } from \"lodash\";\r\nimport { PATH_SPACING_PHYSICS } from \"./game-settings\";\r\n\r\nimport {\r\n  linearInterpolate,\r\n  Point,\r\n  pointAdd,\r\n  pointDistance,\r\n  pointMagnitude,\r\n  pointScale,\r\n  pointSubtract,\r\n  PointZero,\r\n} from \"./points\";\r\n\r\nexport type PointArray = Point[];\r\nexport type ReadOnlyPointArray = readonly Point[];\r\n\r\nexport function pointArrayLength(pointArray: ReadOnlyPointArray): number {\r\n  if (pointArray.length <= 1) {\r\n    return 0;\r\n  }\r\n\r\n  let length = 0;\r\n  let previousPoint = pointArray[0];\r\n  for (let i = 1; i < pointArray.length; i++) {\r\n    length += pointDistance(previousPoint, pointArray[i]);\r\n    previousPoint = pointArray[i];\r\n  }\r\n\r\n  return length;\r\n}\r\n\r\nconst pointArrayLengthCache = new Map<ReadOnlyPointArray, number>();\r\nexport function pointArrayLengthCached(pointArray: ReadOnlyPointArray): number {\r\n  if (pointArray.length <= 1) {\r\n    return 0;\r\n  }\r\n\r\n  let length = pointArrayLengthCache.get(pointArray);\r\n  if (length !== undefined) {\r\n    return length;\r\n  }\r\n\r\n  length = pointArrayLength(pointArray);\r\n  pointArrayLengthCache.set(pointArray, length);\r\n\r\n  return length;\r\n}\r\n\r\nexport function pointArrayLineFromDistance(\r\n  start: Point,\r\n  direction: Point,\r\n  distance: number,\r\n  spacing: number = PATH_SPACING_PHYSICS\r\n) {\r\n  const pointArray: PointArray = [];\r\n  if (pointMagnitude(direction) === 0) {\r\n    throw new Error(\"direction must be valid.\");\r\n  }\r\n\r\n  if (distance <= 0) {\r\n    return [];\r\n  }\r\n\r\n  let previousPoint = start;\r\n  pointArray.push(previousPoint);\r\n  let remainingDistance = distance;\r\n  while (remainingDistance >= spacing) {\r\n    const point = pointAdd(previousPoint, pointScale(direction, spacing));\r\n    pointArray.push(point);\r\n    remainingDistance -= spacing;\r\n    previousPoint = point;\r\n  }\r\n\r\n  if (remainingDistance > 0) {\r\n    pointArray.push(\r\n      pointAdd(previousPoint, pointScale(direction, remainingDistance))\r\n    );\r\n  }\r\n\r\n  return pointArray;\r\n}\r\n\r\nexport function pointArrayOffset(\r\n  pointArray: PointArray,\r\n  offset: Point\r\n): PointArray {\r\n  return pointArray.map((point) => pointAdd(point, offset));\r\n}\r\n\r\nexport function takePointArrayByDistance<T extends Point>(\r\n  array: T[],\r\n  takeLength: number\r\n): [taken: T[], remainder: T[]] {\r\n  const totalLength = pointArrayLength(array);\r\n\r\n  if (array.length <= 1 || totalLength <= takeLength) {\r\n    return [array, [] as T[]];\r\n  }\r\n\r\n  const taken: T[] = [array[0]];\r\n  const remainder: T[] = [];\r\n\r\n  let takenLength = 0;\r\n  let previousPoint = array[0];\r\n  for (let i = 1; i < array.length; i++) {\r\n    const p = array[i];\r\n    const length = pointDistance(p, previousPoint);\r\n    if (takenLength + length >= takeLength) {\r\n      const remainingLength = takeLength - takenLength;\r\n      const splitPoint = linearInterpolate(\r\n        previousPoint,\r\n        p,\r\n        remainingLength / length\r\n      );\r\n      taken.push(\r\n        Object.assign({}, previousPoint, { x: splitPoint.x, y: splitPoint.y })\r\n      );\r\n      remainder.push(\r\n        Object.assign({}, p, { x: splitPoint.x, y: splitPoint.y }),\r\n        ...array.slice(i)\r\n      );\r\n      break;\r\n    } else {\r\n      takenLength += length;\r\n      taken.push(p);\r\n      previousPoint = p;\r\n    }\r\n  }\r\n\r\n  return [taken, remainder];\r\n}\r\n","import { clamp } from \"lodash\";\r\n\r\nexport interface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport const PointZero: Readonly<Point> = Object.freeze({ x: 0, y: 0 });\r\n\r\nexport function pointEquals(a: Point, b: Point): boolean {\r\n  return (\r\n    Math.abs(a.x - b.x) < Number.EPSILON && Math.abs(a.y - b.y) < Number.EPSILON\r\n  );\r\n}\r\n\r\nexport function pointScale(p: Point, factor: number): Point {\r\n  return {\r\n    x: p.x * factor,\r\n    y: p.y * factor,\r\n  };\r\n}\r\n\r\nexport function pointMagnitude(p: Point): number {\r\n  return Math.sqrt(p.x * p.x + p.y * p.y);\r\n}\r\n\r\nexport function pointAngleRadians(from: Point, to: Point): number {\r\n  return Math.atan2(to.y - from.y, to.x - from.x);\r\n}\r\n\r\nexport function pointMoveTowards(\r\n  current: Point,\r\n  target: Point,\r\n  maxDistanceDelta: number\r\n): Point {\r\n  const mt1 = target.x - current.x;\r\n  const mt2 = target.y - current.y;\r\n  const mt3 = mt1 * mt1 + mt2 * mt2;\r\n  if (\r\n    mt3 == 0.0 ||\r\n    (maxDistanceDelta >= 0.0 && mt3 <= maxDistanceDelta * maxDistanceDelta)\r\n  )\r\n    return target;\r\n  const mt4 = Math.sqrt(mt3);\r\n  return {\r\n    x: current.x + (mt1 / mt4) * maxDistanceDelta,\r\n    y: current.y + (mt2 / mt4) * maxDistanceDelta,\r\n  };\r\n}\r\n\r\n/**\r\n * Gets the smallest angle in degrees between two points.\r\n */\r\nexport function pointAngleDegrees180(from: Point, to: Point) {\r\n  const num = Math.sqrt(\r\n    (from.x * from.x + from.y * from.y) * (to.x * to.x + to.y * to.y)\r\n  );\r\n  if (num < Number.EPSILON) {\r\n    return 0;\r\n  }\r\n  return Math.acos(clamp(pointDot(from, to) / num, -1, 1)) * 57.29578;\r\n}\r\n\r\n/**\r\n * Gets the smallest angle between to points.  Value will be negative if the angle if to is counterclockwise of from.\r\n */\r\nexport function pointSignedAngleDegrees180(from: Point, to: Point) {\r\n  const a = pointAngleDegrees180(from, to);\r\n  const sign = Math.sign(from.x * to.y - from.y * to.x);\r\n  const sa = sign * a;\r\n  return sa;\r\n}\r\n\r\nexport function pointRotate(p: Point, angleInRadians: number): Point {\r\n  const x = p.x * Math.cos(angleInRadians) - p.y * Math.sin(angleInRadians);\r\n  const y = p.x * Math.sin(angleInRadians) + p.y * Math.cos(angleInRadians);\r\n  return { x, y };\r\n}\r\n\r\nexport function pointDot(a: Point, b: Point): number {\r\n  return a.x * b.x + a.y * b.y;\r\n}\r\n\r\nexport function pointDistance(p1: Point, p2: Point) {\r\n  const dx = p1.x - p2.x;\r\n  const dy = p1.y - p2.y;\r\n  return Math.sqrt(dx * dx + dy * dy);\r\n}\r\n\r\nexport function pointAdd(a: Point, b: Point) {\r\n  return {\r\n    x: a.x + b.x,\r\n    y: a.y + b.y,\r\n  };\r\n}\r\n\r\nexport function pointSubtract(a: Point, b: Point) {\r\n  return {\r\n    x: a.x - b.x,\r\n    y: a.y - b.y,\r\n  };\r\n}\r\n\r\nexport function pointNormalize(p: Point): Point {\r\n  const magnitude = pointMagnitude(p);\r\n  if (magnitude === 0) {\r\n    return PointZero;\r\n  }\r\n\r\n  return {\r\n    x: p.x / magnitude,\r\n    y: p.y / magnitude,\r\n  };\r\n}\r\n\r\nexport function linearInterpolate(\r\n  start: Point,\r\n  end: Point,\r\n  lerp: number\r\n): Point {\r\n  return {\r\n    x: start.x + (end.x - start.x) * lerp,\r\n    y: start.y + (end.y - start.y) * lerp,\r\n  };\r\n}\r\n","import { Point, pointAdd, PointZero } from \"./points\";\r\nimport { Size } from \"./size\";\r\n\r\nexport interface Rectangle {\r\n  p1: Point;\r\n  p2: Point;\r\n}\r\n\r\nexport const RectZero: Readonly<Rectangle> = Object.freeze({\r\n  p1: PointZero,\r\n  p2: PointZero,\r\n}) as any;\r\n\r\nexport function rectangle(x: number, y: number, w: number, h: number) {\r\n  return {\r\n    p1: { x, y },\r\n    p2: { x: x + w, y: y + h },\r\n  };\r\n}\r\n\r\nexport function rectFromCircle(p: Point, radius: number) {\r\n  return {\r\n    p1: {\r\n      x: p.x - radius,\r\n      y: p.y - radius,\r\n    },\r\n    p2: {\r\n      x: p.x + radius,\r\n      y: p.y + radius,\r\n    },\r\n  };\r\n}\r\n\r\nexport function rectOffset(r: Rectangle, offset: Point) {\r\n  return {\r\n    p1: pointAdd(r.p1, offset),\r\n    p2: pointAdd(r.p2, offset),\r\n  };\r\n}\r\n\r\nexport function normalizeRectangle(p1: Point, p2: Point): Rectangle;\r\nexport function normalizeRectangle(r: Rectangle): Rectangle;\r\nexport function normalizeRectangle(...args: any[]): Rectangle {\r\n  let p1: Point;\r\n  let p2: Point;\r\n  if (args.length === 1) {\r\n    const r = args[0] as Rectangle;\r\n    p1 = r.p1;\r\n    p2 = r.p2;\r\n  } else {\r\n    p1 = args[0] as Point;\r\n    p2 = args[1] as Point;\r\n  }\r\n  return {\r\n    p1: {\r\n      x: Math.min(p1.x, p2.x),\r\n      y: Math.min(p1.y, p2.y),\r\n    },\r\n    p2: {\r\n      x: Math.max(p1.x, p2.x),\r\n      y: Math.max(p1.y, p2.y),\r\n    },\r\n  };\r\n}\r\n\r\nexport function addPointToRect(r: Rectangle, p: Point): Rectangle {\r\n  return {\r\n    p1: {\r\n      x: Math.min(r.p1.x, p.x),\r\n      y: Math.min(r.p1.y, p.y),\r\n    },\r\n    p2: {\r\n      x: Math.max(r.p2.x, p.x),\r\n      y: Math.max(r.p2.y, p.y),\r\n    },\r\n  };\r\n}\r\n\r\nexport function pointIntersectsRect(p: Point, r: Rectangle): boolean {\r\n  r = normalizeRectangle(r);\r\n\r\n  if (r.p1.x > p.x || r.p2.x < p.x) {\r\n    return false;\r\n  }\r\n\r\n  if (r.p1.y > p.y || r.p2.y < p.y) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nexport function rectSize(r: Rectangle): Size {\r\n  r = normalizeRectangle(r);\r\n  return {\r\n    width: r.p2.x - r.p1.x,\r\n    height: r.p2.y - r.p1.y,\r\n  };\r\n}\r\n","import platform from \"platform\";\r\n\r\nconst OS_WINDOWS = /windows/i;\r\nconst OS_MAC = /Mac|iOS|(OS\\ X)/;\r\nconst OS_LINUX = /linux/i;\r\n\r\nexport type OSType = \"windows\" | \"mac\" | \"linux\" | \"unknown\";\r\n\r\nconst osPlatform = (platform.os && platform.os.family) || \"unknown\";\r\nexport const OSType: OSType = OS_WINDOWS.test(osPlatform)\r\n  ? \"windows\"\r\n  : OS_MAC.test(osPlatform)\r\n  ? \"mac\"\r\n  : OS_LINUX.test(osPlatform)\r\n  ? \"linux\"\r\n  : \"unknown\";\r\n\r\nexport const isProd: boolean = process.env.NODE_ENV === \"production\";\r\n\r\nexport const keyboardModifierUseMeta = osPlatform === \"mac\";\r\n","import { injectable, singleton } from \"microinject\";\r\n\r\nimport { ingredients } from \"./ingredients\";\r\nimport { IngredientDescriptor, IngredientId } from \"./types\";\r\n\r\n@injectable()\r\n@singleton()\r\nexport class IngredientRegistry {\r\n  getIngredients(): readonly IngredientDescriptor[] {\r\n    return ingredients;\r\n  }\r\n\r\n  getIngredientById(id: IngredientId): IngredientDescriptor | null {\r\n    return ingredients.find((x) => x.id === id) ?? null;\r\n  }\r\n}\r\n","import { cubicBezierCurve } from \"@/curves\";\r\nimport { IngredientDescriptor, ingredientId } from \"./types\";\r\n\r\nexport const ingredients: IngredientDescriptor[] = [\r\n  {\r\n    id: ingredientId(\"BloodRuby\"),\r\n\r\n    name: \"Blood Ruby\",\r\n\r\n    color: \"#C24647\",\r\n\r\n    price: 90,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, -3, -3, -3, -3),\r\n\r\n      cubicBezierCurve(-3, -3, -3, -3, -3, 3, -3, 3),\r\n\r\n      cubicBezierCurve(-3, 3, -3, 3, -5.9999, 0, -6, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.1465,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"BloodyRoot\"),\r\n\r\n    name: \"Bloodthorn\",\r\n\r\n    color: \"#AC4937\",\r\n\r\n    price: 14,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, 0.0001001358, -2, 0, -2),\r\n\r\n      cubicBezierCurve(0, -2, -0.0001001358, -2, -1.7499, 1, -1.75, 1),\r\n\r\n      cubicBezierCurve(-1.75, 1, -1.7501, 1, -1.7501, -3, -1.75, -3),\r\n\r\n      cubicBezierCurve(-1.75, -3, -1.7499, -3, -4.0001, 2, -4, 2),\r\n\r\n      cubicBezierCurve(-4, 2, -3.9999, 2, -3.9999, -4, -4, -4),\r\n\r\n      cubicBezierCurve(-4, -4, -4.0001, -4, -5.9999, 0, -6, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.435,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"CliffFungus\"),\r\n\r\n    name: \"Brown Mushroom\",\r\n\r\n    color: \"#957C64\",\r\n\r\n    price: 6,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0, -1, 0, -1, -1, -1),\r\n\r\n      cubicBezierCurve(-1, -1, -2, -1, -2, -1, -2, -2),\r\n\r\n      cubicBezierCurve(-2, -2, -2, -3, -2, -3, 0, -3),\r\n\r\n      cubicBezierCurve(0, -3, 2, -3, 2, -3, 2, -4),\r\n\r\n      cubicBezierCurve(2, -4, 2, -5, 2, -5, 0.5, -5),\r\n\r\n      cubicBezierCurve(0.5, -5, 0, -5, 0, -5, 0, -6),\r\n    ],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Crystal\"),\r\n\r\n    name: \"Cloud Crystal\",\r\n\r\n    color: \"#ADADAD\",\r\n\r\n    price: 60,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0, 0, -0.75, 1, 0, 1.5),\r\n\r\n      cubicBezierCurve(0, 1.5, 0.7499999, 2, 1, 2, 1, 2.75),\r\n\r\n      cubicBezierCurve(1, 2.75, 0.9999999, 3.75, -0.9999999, 3.25, -1, 4.25),\r\n\r\n      cubicBezierCurve(-1, 4.25, -1, 5, -0.75, 5, 0, 5.5),\r\n\r\n      cubicBezierCurve(0, 5.5, 0.7499999, 6, 0.0001, 7, 0, 7),\r\n    ],\r\n\r\n    preGrindPercent: 0.177,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"DryadMushroom\"),\r\n\r\n    name: \"Dryad's Saddle\",\r\n\r\n    color: \"#9C785A\",\r\n\r\n    price: 5.5,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, -0.25, 0, -1.33541, -0.3291796, -1, -1),\r\n\r\n      cubicBezierCurve(-1, -1, -0.5, -2, 2, -0.5, 2, -2),\r\n\r\n      cubicBezierCurve(2, -2, 2, -3.5, -2, -1.25, -2, -3),\r\n\r\n      cubicBezierCurve(-2, -3, -2, -3.75, 0.0001, -3.75, 0, -3.75),\r\n    ],\r\n\r\n    preGrindPercent: 0.53,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"EarthCrystal\"),\r\n\r\n    name: \"Earth Pyrite\",\r\n\r\n    color: \"#93806A\",\r\n\r\n    price: 30,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, 0, -1.5, 0, -1.5),\r\n\r\n      cubicBezierCurve(0, -1.5, 0, -1.5, -1, -1.5, -1, -1.5),\r\n\r\n      cubicBezierCurve(-1, -1.5, -1, -1.5, -1, -3.5, -1, -3.5),\r\n\r\n      cubicBezierCurve(-1, -3.5, -1, -3.5, 1, -3.5, 1, -3.5),\r\n\r\n      cubicBezierCurve(1, -3.5, 1, -3.5, 1, -5.5, 1, -5.5),\r\n\r\n      cubicBezierCurve(1, -5.5, 1, -5.5, 0, -5.5, 0, -5.5),\r\n\r\n      cubicBezierCurve(0, -5.5, 0, -5.5, 0.0001, -7, 0, -7),\r\n    ],\r\n\r\n    preGrindPercent: 0.1364,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Firebell\"),\r\n\r\n    name: \"Firebell\",\r\n\r\n    color: \"#D1810D\",\r\n\r\n    price: 5,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, -1.25, 1, -1.2501, 1, -1.25, 1),\r\n\r\n      cubicBezierCurve(-1.25, 1, -1.2499, 1, -2.5001, 0, -2.5, 0),\r\n\r\n      cubicBezierCurve(-2.5, 0, -2.4999, 0, -3.7501, 1, -3.75, 1),\r\n\r\n      cubicBezierCurve(-3.75, 1, -3.7499, 1, -3.75, 1, -5, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"FireCitrine\"),\r\n\r\n    name: \"Fire Citrine\",\r\n\r\n    color: \"#CD7C19\",\r\n\r\n    price: 50,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, -0.75, -1.5, -1.5, 0),\r\n\r\n      cubicBezierCurve(-1.5, 0, -2.5, 2, -2.75, -0.7499999, -3.5, -0.75),\r\n\r\n      cubicBezierCurve(-3.5, -0.75, -4.25, -0.75, -4.5, 2, -5.5, 0),\r\n\r\n      cubicBezierCurve(-5.5, 0, -6.25, -1.5, -6.9999, 0, -7, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.202,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"FrostSapphire\"),\r\n\r\n    name: \"Frost Sapphire\",\r\n\r\n    color: \"#7399BF\",\r\n\r\n    price: 40,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0, 0, 0.25, 0.5, 0.25, 0.5),\r\n\r\n      cubicBezierCurve(0.25, 0.5, 0.25, 0.5, 1, -1, 1, -1),\r\n\r\n      cubicBezierCurve(1, -1, 1, -1, 2, 1, 2, 1),\r\n\r\n      cubicBezierCurve(2, 1, 2, 1, 3, -1, 3, -1),\r\n\r\n      cubicBezierCurve(3, -1, 3, -1, 4, 1, 4, 1),\r\n\r\n      cubicBezierCurve(4, 1, 4, 1, 5, -1, 5, -1),\r\n\r\n      cubicBezierCurve(5, -1, 5, -1, 6, 1, 6, 1),\r\n\r\n      cubicBezierCurve(6, 1, 6, 1, 6.75, -0.5, 6.75, -0.5),\r\n\r\n      cubicBezierCurve(6.75, -0.5, 6.75, -0.5, 7.0001, 0, 7, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.2139,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"GoblinMushroom\"),\r\n\r\n    name: \"Goblin Shroom\",\r\n\r\n    color: \"#928A5E\",\r\n\r\n    price: 5,\r\n\r\n    path: [cubicBezierCurve(0, 0, 3, 0, 3, -5, 0, -5)],\r\n\r\n    preGrindPercent: 0.663,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Goldthorn\"),\r\n\r\n    name: \"Goldthorn\",\r\n\r\n    color: \"#96714E\",\r\n\r\n    price: 12.5,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, -0.25, 0, -0.5, 0.25, -0.5, 0.5),\r\n\r\n      cubicBezierCurve(-0.5, 0.5, -0.5, 0.75, -0.25, 1, 0, 1),\r\n\r\n      cubicBezierCurve(0, 1, 1, 1, 1, 0.5, 1, 0),\r\n\r\n      cubicBezierCurve(1, 0, 1, -0.5, 0.5, -0.9999999, 0, -1),\r\n\r\n      cubicBezierCurve(0, -1, -0.75, -1, -1.5, -0.25, -1.5, 0.25),\r\n\r\n      cubicBezierCurve(-1.5, 0.25, -1.5, 1.75, -0.75, 2, 0, 2),\r\n\r\n      cubicBezierCurve(0, 2, 1.25, 2, 2, 1.25, 2, 0),\r\n\r\n      cubicBezierCurve(2, 0, 2, -1, 1, -2, 0, -2),\r\n    ],\r\n\r\n    preGrindPercent: 0.3013,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"GraveTruffle\"),\r\n\r\n    name: \"Grave Truffle\",\r\n\r\n    color: \"#908B7F\",\r\n\r\n    price: 10,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, -3.0001, -2, -3, -2),\r\n\r\n      cubicBezierCurve(-3, -2, -2.9999, -2, -0.7501, -7, -0.75, -7),\r\n\r\n      cubicBezierCurve(-0.75, -7, -0.7499, -7, 0.7499, -7, 0.75, -7),\r\n\r\n      cubicBezierCurve(0.75, -7, 0.7501, -7, 3, -2, 3, -2),\r\n\r\n      cubicBezierCurve(3, -2, 3, -2, -0.0001, -1.25, 0, -1.25),\r\n\r\n      cubicBezierCurve(0, -1.25, 0.0001, -1.25, 0.0001, -5, 0, -5),\r\n    ],\r\n\r\n    preGrindPercent: 0.2535,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"GreenMushroom\"),\r\n\r\n    name: \"Green Mushroom\",\r\n\r\n    color: \"#A5A24F\",\r\n\r\n    price: 9,\r\n\r\n    path: [\r\n      cubicBezierCurve(\r\n        0,\r\n        0,\r\n        3.02107,\r\n        1.020414,\r\n        0.5508628,\r\n        -1.518064,\r\n        1.527383,\r\n        -2.506451\r\n      ),\r\n\r\n      cubicBezierCurve(\r\n        1.527383,\r\n        -2.506451,\r\n        2.500548,\r\n        -3.491441,\r\n        5.012281,\r\n        -0.9910625,\r\n        3.996144,\r\n        -3.978157\r\n      ),\r\n    ],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"GreyChanterelle\"),\r\n\r\n    name: \"Shadow Chanterelle\",\r\n\r\n    color: \"#887C77\",\r\n\r\n    price: 10,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 3, 0, -2.384186e-7, 5, 3, 5),\r\n\r\n      cubicBezierCurve(3, 5, 4, 5, 4.5, 4, 4.5, 3),\r\n    ],\r\n\r\n    preGrindPercent: 0.512,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"IceDragonfruit\"),\r\n\r\n    name: \"Ice Fruit\",\r\n\r\n    color: \"#5D8089\",\r\n\r\n    price: 9,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, 0.9999, 2, 1, 2),\r\n\r\n      cubicBezierCurve(1, 2, 1.0001, 2, 3, -2, 3, -2),\r\n\r\n      cubicBezierCurve(3, -2, 3, -2, 4.9999, 2, 5, 2),\r\n\r\n      cubicBezierCurve(5, 2, 5.0001, 2, 6.0001, 0, 6, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.333,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"LavaRoot\"),\r\n\r\n    name: \"Lava Root\",\r\n\r\n    color: \"#C86B41\",\r\n\r\n    price: 11.5,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0, 1.5, -2.5, 1.5, -2.5, 0),\r\n\r\n      cubicBezierCurve(-2.5, 0, -2.5, -1.5, -5, -1.5, -5, 0),\r\n\r\n      cubicBezierCurve(-5, 0, -5, 1.5, -7.5, 1.5, -7.5, 0),\r\n\r\n      cubicBezierCurve(-7.5, 0, -7.5, -0.75, -6.25, -0.75, -6.25, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.4289,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Leaf\"),\r\n\r\n    name: \"Terraria\",\r\n\r\n    color: \"#749064\",\r\n\r\n    price: 3,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, -0.25, -0.75, 0, -1),\r\n\r\n      cubicBezierCurve(0, -1, 0.25, -1.25, 0.5, -1, 0.75, -1.25),\r\n\r\n      cubicBezierCurve(0.75, -1.25, 1, -1.5, 1, -2.25, 0.75, -2.5),\r\n\r\n      cubicBezierCurve(0.75, -2.5, 0.5, -2.75, -0.5, -2.25, -0.75, -2.5),\r\n\r\n      cubicBezierCurve(-0.75, -2.5, -1, -2.75, -1, -3.5, -0.75, -3.75),\r\n\r\n      cubicBezierCurve(-0.75, -3.75, -0.5, -4, -0.1767767, -3.823223, 0, -4),\r\n\r\n      cubicBezierCurve(0, -4, 0.25, -4.25, 0.0001, -5, 0, -5),\r\n    ],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"LumpyBeet\"),\r\n\r\n    name: \"Lumpy Beet\",\r\n\r\n    color: \"#A36674\",\r\n\r\n    price: 9,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0, 2, 3, 1, 3, 3),\r\n\r\n      cubicBezierCurve(3, 3, 3, 4, 1, 4, 1, 3),\r\n\r\n      cubicBezierCurve(1, 3, 1, 2, 1, 1, 1, 0),\r\n\r\n      cubicBezierCurve(1, 0, 1, -1, 3, -1, 3, 0),\r\n\r\n      cubicBezierCurve(3, 0, 3, 1, 3, 2, 4, 2),\r\n    ],\r\n\r\n    preGrindPercent: 0.1805,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Marshrooms\"),\r\n\r\n    name: \"Marshroom\",\r\n\r\n    color: \"#837956\",\r\n\r\n    price: 7,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 2, -2, 1, -4, 3, -4),\r\n\r\n      cubicBezierCurve(3, -4, 3.5, -4, 5, -4, 5, -3),\r\n    ],\r\n\r\n    preGrindPercent: 0.423,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"RedMushroom\"),\r\n\r\n    name: \"Red Mushroom\",\r\n\r\n    color: \"#A76C3F\",\r\n\r\n    price: 9.5,\r\n\r\n    path: [cubicBezierCurve(0, 0, -4, 4, -4, -4, -8, 0)],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Refruit\"),\r\n\r\n    name: \"Hairy Banana\",\r\n\r\n    color: \"#C5B13E\",\r\n\r\n    price: 12.5,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, -3, -3, -4, -3),\r\n\r\n      cubicBezierCurve(-4, -3, -5, -3, -8.000098, -2.453497e-5, -8, 0),\r\n\r\n      cubicBezierCurve(-8, 0, -7, 0.25, -5, -1.25, -4, -1),\r\n    ],\r\n\r\n    preGrindPercent: 0.3375,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"SulphurShelf\"),\r\n\r\n    name: \"Sulphur Shelf\",\r\n\r\n    color: \"#D77838\",\r\n\r\n    price: 11,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, -2, 0, -3.5, 0, -3.5, 0.75),\r\n\r\n      cubicBezierCurve(-3.5, 0.75, -3.5, 1.5, -2.75, 1.5, -2.25, 1.5),\r\n\r\n      cubicBezierCurve(-2.25, 1.5, -1.75, 1.5, -1, 1.5, -1, 2.25),\r\n\r\n      cubicBezierCurve(-1, 2.25, -1, 3, -2.5, 3, -4.5, 3),\r\n    ],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Tangleweeds\"),\r\n\r\n    name: \"Tangleweed\",\r\n\r\n    color: \"#759786\",\r\n\r\n    price: 8.5,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0, -1, 3, -1, 3, 0),\r\n\r\n      cubicBezierCurve(3, 0, 3, 1, 1.5, 1, 1.5, 0),\r\n\r\n      cubicBezierCurve(1.5, 0, 1.5, -1, 3, -2, 4, 0),\r\n\r\n      cubicBezierCurve(4, 0, 5, 2, 6.5, 1, 6.5, 0),\r\n\r\n      cubicBezierCurve(6.5, 0, 6.5, -1, 5, -1, 5, 0),\r\n\r\n      cubicBezierCurve(5, 0, 5, 1, 8, 1, 8, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.5005,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Thistle\"),\r\n\r\n    name: \"Thunder Thistle\",\r\n\r\n    color: \"#9E5874\",\r\n\r\n    price: 9,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, 1.9999, 3.5, 2, 3.5),\r\n\r\n      cubicBezierCurve(2, 3.5, 2.0001, 3.5, -0.9999, 2.5, -1, 2.5),\r\n\r\n      cubicBezierCurve(-1, 2.5, -1.0001, 2.5, 1.0001, 6, 1, 6),\r\n    ],\r\n\r\n    preGrindPercent: 0.353,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Thornstick\"),\r\n\r\n    name: \"Thornstick\",\r\n\r\n    color: \"#818C4D\",\r\n\r\n    price: 8,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, -3.9999, -6, -4, -6),\r\n\r\n      cubicBezierCurve(-4, -6, -4.0001, -6, -1.9999, -5, -2, -5),\r\n    ],\r\n\r\n    preGrindPercent: 0.319,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Waterbloom\"),\r\n\r\n    name: \"Waterbloom\",\r\n\r\n    color: \"#539278\",\r\n\r\n    price: 4,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.25, -0.5, 1, -0.5, 1.25, 0),\r\n\r\n      cubicBezierCurve(1.25, 0, 1.5, 0.4999999, 2.25, 0.5, 2.5, 0),\r\n\r\n      cubicBezierCurve(2.5, 0, 2.75, -0.5, 3.5, -0.5, 3.75, 0),\r\n\r\n      cubicBezierCurve(3.75, 0, 4, 0.4999999, 4.75, 0.5, 5, 0),\r\n    ],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Wierdshroom\"),\r\n\r\n    name: \"Weirdshroom\",\r\n\r\n    color: \"#B88A51\",\r\n\r\n    price: 8.5,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, -2, 0, -2, -6, -1, -6),\r\n\r\n      cubicBezierCurve(-1, -6, 0.25, -6, 1.353553, -6.207107, 1, -5.5),\r\n\r\n      cubicBezierCurve(1, -5.5, 0.5, -4.5, -0.25, -3.75, 0, -3),\r\n    ],\r\n\r\n    preGrindPercent: 0.3045,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"Windbloom\"),\r\n\r\n    name: \"Windbloom\",\r\n\r\n    color: \"#ADABA2\",\r\n\r\n    price: 6,\r\n\r\n    path: [\r\n      cubicBezierCurve(0, 0, 0.0001, 0, 0, 0, 0.5, 1.25),\r\n\r\n      cubicBezierCurve(0.5, 1.25, 0.9999999, 2.5, 0.9999, 2.5, 1, 2.5),\r\n\r\n      cubicBezierCurve(1, 2.5, 1.0001, 2.5, -1.0001, 2.5, -1, 2.5),\r\n\r\n      cubicBezierCurve(-1, 2.5, -0.9999, 2.5, -1, 2.5, -0.5, 3.75),\r\n\r\n      cubicBezierCurve(-0.5, 3.75, -2.086163e-7, 5, 0.0001, 5, 0, 5),\r\n    ],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n\r\n  {\r\n    id: ingredientId(\"WitchMushroom\"),\r\n\r\n    name: \"Witch Mushroom\",\r\n\r\n    color: \"#92777C\",\r\n\r\n    price: 13,\r\n\r\n    path: [cubicBezierCurve(0, 0, 0, 4, 5, 1, 5, 5)],\r\n\r\n    preGrindPercent: 0.5,\r\n  },\r\n];\r\n","import { ContainerModule } from \"microinject\";\r\n\r\nimport { IngredientRegistry } from \"./IngredientRegistry\";\r\n\r\nexport default new ContainerModule((bind) => {\r\n  bind(IngredientRegistry);\r\n});\r\n","import { CubicBezierCurve } from \"@/curves\";\r\nimport { Opaque } from \"type-fest\";\r\n\r\nexport type IngredientId = Opaque<string, \"IngredientName\">;\r\nexport function ingredientId(id: string): IngredientId {\r\n  return id as IngredientId;\r\n}\r\n\r\nexport interface IngredientDescriptor {\r\n  readonly id: IngredientId;\r\n  readonly name: string;\r\n  readonly color: string;\r\n  readonly price: number;\r\n  readonly path: CubicBezierCurve[];\r\n  readonly preGrindPercent: number;\r\n}\r\n","import { composeModules } from \"microinject\";\r\n\r\nimport ingredientsModule from \"./ingredients/module\";\r\nimport plotterModule from \"./plotter/module\";\r\nimport potionBasesModule from \"./potion-bases/module\";\r\n\r\nexport default composeModules(\r\n  ingredientsModule,\r\n  plotterModule,\r\n  potionBasesModule\r\n);\r\n","import { isNotNull } from \"@/utils\";\r\nimport { inject, injectable } from \"microinject\";\r\nimport {\r\n  BehaviorSubject,\r\n  combineLatest,\r\n  map,\r\n  Observable,\r\n  Subscription,\r\n} from \"rxjs\";\r\nimport pako from \"pako\";\r\nimport {\r\n  encode as encodeBase64,\r\n  decode as decodeBase64,\r\n} from \"base64-arraybuffer\";\r\n\r\nimport { IngredientId } from \"../ingredients/types\";\r\n\r\nimport { PotionMap } from \"../potion-maps/PotionMap\";\r\nimport { PotionBaseRegistry } from \"../potion-bases/PotionBaseRegistry\";\r\n\r\nimport { Plotter } from \"./Plotter\";\r\nimport { PlotItem, PlotResult } from \"./types\";\r\n\r\n@injectable()\r\nexport class PlotBuilder {\r\n  private readonly _map$ = new BehaviorSubject<PotionMap | null>(null);\r\n  private readonly _items$ = new BehaviorSubject<readonly PlotBuilderItem[]>(\r\n    []\r\n  );\r\n  private _itemSubscription: Subscription | null = null;\r\n  private readonly _plot$ = new BehaviorSubject<PlotResult | null>(null);\r\n\r\n  constructor(\r\n    @inject(PotionBaseRegistry) potionBaseRegistry: PotionBaseRegistry,\r\n    @inject(Plotter) plotter: Plotter\r\n  ) {\r\n    this._map$.next(potionBaseRegistry.getPotionBaseById(\"water\" as any)!.map);\r\n\r\n    // This is a little wonky, but subscribing to all observables in an observable array is something I could see wanting to do a lot.\r\n    // Should make a utility function to handle this use case, if one doesnt already exist in rxjs.\r\n    this._items$.subscribe((items) => {\r\n      if (this._itemSubscription) {\r\n        this._itemSubscription.unsubscribe();\r\n      }\r\n\r\n      if (items.length === 0) {\r\n        this._plot$.next(null);\r\n        return;\r\n      }\r\n\r\n      this._itemSubscription = combineLatest([\r\n        this._map$,\r\n        ...items.map((x) => x.plotItem$),\r\n      ]).subscribe(([map, ...plotItems]) => {\r\n        if (map == null) {\r\n          return null;\r\n        }\r\n        this._plot$.next(plotter.plotItems(plotItems.filter(isNotNull), map));\r\n      });\r\n    });\r\n  }\r\n\r\n  get map$() {\r\n    return this._map$;\r\n  }\r\n\r\n  get items$() {\r\n    return this._items$;\r\n  }\r\n\r\n  get items(): readonly PlotBuilderItem[] {\r\n    return this._items$.value;\r\n  }\r\n\r\n  get plot$() {\r\n    return this._plot$;\r\n  }\r\n\r\n  loadFromShareString(dataStr: string) {\r\n    const array = decodeBase64(dataStr);\r\n    const dv = new DataView(array);\r\n    const version = dv.getUint8(0);\r\n    const data = array.slice(1);\r\n    if (version === 0) {\r\n      const decoded = JSON.parse(pako.inflate(data, { to: \"string\" })) as any[];\r\n      const items = decoded.map((item) => {\r\n        switch (item.type) {\r\n          case \"add-ingredient\":\r\n            return AddIngredientPlotBuilderItem.fromJSON(item, (item) =>\r\n              this._deleteItem(item)\r\n            );\r\n          case \"stir-cauldron\":\r\n            return StirCauldronPlotBuilderItem.fromJSON(item, (item) =>\r\n              this._deleteItem(item)\r\n            );\r\n          case \"pour-solvent\":\r\n            return PourSolventPlotBuilderItem.fromJSON(item, (item) =>\r\n              this._deleteItem(item)\r\n            );\r\n          case \"heat-vortex\":\r\n            return HeatVortexPlotBuilderItem.fromJSON(item, (item) =>\r\n              this._deleteItem(item)\r\n            );\r\n          default:\r\n            throw new Error(`Unknown item type: ${item.type}`);\r\n        }\r\n      });\r\n      this._items$.next(items);\r\n    }\r\n  }\r\n\r\n  getShareString() {\r\n    const items = this._items$.value.map((x) => x.toJSON());\r\n    const encoded = pako.deflate(JSON.stringify(items));\r\n    const data = new Uint8Array(1 + encoded.length);\r\n    data.set(encoded, 1);\r\n    new DataView(data.buffer).setUint8(0, 0);\r\n    return encodeBase64(data);\r\n  }\r\n\r\n  addIngredient(): AddIngredientPlotBuilderItem {\r\n    const item = new AddIngredientPlotBuilderItem((item) =>\r\n      this._deleteItem(item)\r\n    );\r\n    this._items$.next([...this._items$.value, item]);\r\n    return item;\r\n  }\r\n\r\n  addStirCauldron(): StirCauldronPlotBuilderItem {\r\n    const item = new StirCauldronPlotBuilderItem((item) =>\r\n      this._deleteItem(item)\r\n    );\r\n    this._items$.next([...this._items$.value, item]);\r\n    return item;\r\n  }\r\n\r\n  addPourSolvent(): PourSolventPlotBuilderItem {\r\n    const item = new PourSolventPlotBuilderItem((item) =>\r\n      this._deleteItem(item)\r\n    );\r\n    this._items$.next([...this._items$.value, item]);\r\n    return item;\r\n  }\r\n\r\n  addHeatVortex(): HeatVortexPlotBuilderItem {\r\n    const item = new HeatVortexPlotBuilderItem((item) =>\r\n      this._deleteItem(item)\r\n    );\r\n    this._items$.next([...this._items$.value, item]);\r\n    return item;\r\n  }\r\n\r\n  builderItemFor(item: PlotItem): PlotBuilderItem | null {\r\n    const result = this._items$.value.find((x) => x.plotItem === item) || null;\r\n    return result;\r\n  }\r\n\r\n  private _deleteItem(item: PlotBuilderItem) {\r\n    this._items$.next(this._items$.value.filter((x) => x !== item));\r\n  }\r\n}\r\n\r\nexport abstract class PlotBuilderItem {\r\n  abstract readonly isValid$: Observable<boolean>;\r\n  abstract readonly isValid: boolean;\r\n\r\n  abstract readonly plotItem$: Observable<PlotItem | null>;\r\n  abstract readonly plotItem: PlotItem | null;\r\n\r\n  abstract delete(): void;\r\n\r\n  abstract toJSON(): any;\r\n}\r\n\r\nexport class AddIngredientPlotBuilderItem extends PlotBuilderItem {\r\n  private readonly _isValid$: Observable<boolean>;\r\n  private readonly _ingredientId$ = new BehaviorSubject<IngredientId | null>(\r\n    null\r\n  );\r\n  private readonly _grindPercent$ = new BehaviorSubject<number>(1);\r\n\r\n  private readonly _plotItem$ = new BehaviorSubject<PlotItem | null>(null);\r\n\r\n  constructor(private readonly _delete: (item: PlotBuilderItem) => void) {\r\n    super();\r\n    this._isValid$ = combineLatest([\r\n      this._ingredientId$,\r\n      this._grindPercent$,\r\n    ]).pipe(map(() => this.isValid));\r\n\r\n    combineLatest([this._ingredientId$, this._grindPercent$]).subscribe(\r\n      ([ingredientId, grindPercent]) => {\r\n        if (!this.isValid) {\r\n          this._plotItem$.next(null);\r\n          return;\r\n        }\r\n\r\n        this._plotItem$.next({\r\n          type: \"add-ingredient\",\r\n          ingredientId: ingredientId as IngredientId,\r\n          grindPercent,\r\n        });\r\n      }\r\n    );\r\n  }\r\n\r\n  static fromJSON(\r\n    json: any,\r\n    del: (item: PlotBuilderItem) => void\r\n  ): AddIngredientPlotBuilderItem {\r\n    const item = new AddIngredientPlotBuilderItem(del);\r\n    item.setIngredient(json.ingredientId);\r\n    item.setGrindPercent(json.grindPercent);\r\n    return item;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: \"add-ingredient\",\r\n      ingredientId: this._ingredientId$.value,\r\n      grindPercent: this._grindPercent$.value,\r\n    };\r\n  }\r\n\r\n  get isValid$() {\r\n    return this._isValid$;\r\n  }\r\n\r\n  get isValid() {\r\n    // TODO: Check if ingredientId is valid\r\n    const grindPercent = this._grindPercent$.value;\r\n    return (\r\n      this._ingredientId$.value != null &&\r\n      grindPercent >= 0 &&\r\n      grindPercent <= 1\r\n    );\r\n  }\r\n\r\n  get ingredientId$(): Observable<IngredientId | null> {\r\n    return this._ingredientId$;\r\n  }\r\n\r\n  get ingredientId(): IngredientId | null {\r\n    return this._ingredientId$.value;\r\n  }\r\n\r\n  get grindPercent$(): Observable<number> {\r\n    return this._grindPercent$;\r\n  }\r\n\r\n  get plotItem$(): Observable<PlotItem | null> {\r\n    return this._plotItem$;\r\n  }\r\n\r\n  get plotItem(): PlotItem | null {\r\n    return this._plotItem$.value;\r\n  }\r\n\r\n  setIngredient(ingredientId: IngredientId | null) {\r\n    if (ingredientId === this._ingredientId$.value) {\r\n      return;\r\n    }\r\n\r\n    this._ingredientId$.next(ingredientId);\r\n  }\r\n\r\n  setGrindPercent(percent: number) {\r\n    if (percent === this._grindPercent$.value) {\r\n      return;\r\n    }\r\n\r\n    this._grindPercent$.next(percent);\r\n  }\r\n\r\n  delete() {\r\n    this._delete(this);\r\n  }\r\n}\r\n\r\nexport class StirCauldronPlotBuilderItem extends PlotBuilderItem {\r\n  private readonly _isValid$: Observable<boolean>;\r\n  private readonly _distance$ = new BehaviorSubject<number | null>(null);\r\n\r\n  private readonly _plotItem$ = new BehaviorSubject<PlotItem | null>(null);\r\n\r\n  constructor(private readonly _delete: (item: PlotBuilderItem) => void) {\r\n    super();\r\n    this._isValid$ = combineLatest([this._distance$]).pipe(\r\n      map(() => this.isValid)\r\n    );\r\n\r\n    combineLatest([this._distance$]).subscribe(([stirDistance]) => {\r\n      if (!this.isValid) {\r\n        this._plotItem$.next(null);\r\n        return;\r\n      }\r\n\r\n      this._plotItem$.next({\r\n        type: \"stir-cauldron\",\r\n        distance: stirDistance!,\r\n      });\r\n    });\r\n  }\r\n\r\n  static fromJSON(\r\n    json: any,\r\n    del: (item: PlotBuilderItem) => void\r\n  ): StirCauldronPlotBuilderItem {\r\n    const item = new StirCauldronPlotBuilderItem(del);\r\n    item.setDistance(json.distance);\r\n    return item;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: \"stir-cauldron\",\r\n      distance: this._distance$.value,\r\n    };\r\n  }\r\n\r\n  get isValid$() {\r\n    return this._isValid$;\r\n  }\r\n\r\n  get isValid() {\r\n    // TODO: Check if ingredientId is valid\r\n    const stirDistance = this._distance$.value;\r\n    return stirDistance != null && stirDistance >= 0;\r\n  }\r\n\r\n  get plotItem$(): Observable<PlotItem | null> {\r\n    return this._plotItem$;\r\n  }\r\n\r\n  get plotItem(): PlotItem | null {\r\n    return this._plotItem$.value;\r\n  }\r\n\r\n  get distance$(): Observable<number | null> {\r\n    return this._distance$;\r\n  }\r\n\r\n  setDistance(distance: number | null) {\r\n    this._distance$.next(distance);\r\n  }\r\n\r\n  delete() {\r\n    this._delete(this);\r\n  }\r\n}\r\n\r\nexport class PourSolventPlotBuilderItem extends PlotBuilderItem {\r\n  private readonly _isValid$: Observable<boolean>;\r\n  private readonly _distance$ = new BehaviorSubject<number | null>(null);\r\n\r\n  private readonly _plotItem$ = new BehaviorSubject<PlotItem | null>(null);\r\n\r\n  constructor(private readonly _delete: (item: PlotBuilderItem) => void) {\r\n    super();\r\n    this._isValid$ = combineLatest([this._distance$]).pipe(\r\n      map(() => this.isValid)\r\n    );\r\n\r\n    combineLatest([this._distance$]).subscribe(([distance]) => {\r\n      if (!this.isValid) {\r\n        this._plotItem$.next(null);\r\n        return;\r\n      }\r\n\r\n      this._plotItem$.next({\r\n        type: \"pour-solvent\",\r\n        distance: distance!,\r\n      });\r\n    });\r\n  }\r\n\r\n  static fromJSON(\r\n    json: any,\r\n    del: (item: PlotBuilderItem) => void\r\n  ): PourSolventPlotBuilderItem {\r\n    const item = new PourSolventPlotBuilderItem(del);\r\n    item.setDistance(json.distance);\r\n    return item;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: \"pour-solvent\",\r\n      distance: this._distance$.value,\r\n    };\r\n  }\r\n\r\n  get isValid$() {\r\n    return this._isValid$;\r\n  }\r\n\r\n  get isValid() {\r\n    const distance = this._distance$.value;\r\n    return distance != null && distance >= 0;\r\n  }\r\n\r\n  get plotItem$(): Observable<PlotItem | null> {\r\n    return this._plotItem$;\r\n  }\r\n\r\n  get plotItem(): PlotItem | null {\r\n    return this._plotItem$.value;\r\n  }\r\n\r\n  get distance$(): Observable<number | null> {\r\n    return this._distance$;\r\n  }\r\n\r\n  setDistance(distance: number | null) {\r\n    this._distance$.next(distance);\r\n  }\r\n\r\n  delete() {\r\n    this._delete(this);\r\n  }\r\n}\r\n\r\nexport class HeatVortexPlotBuilderItem extends PlotBuilderItem {\r\n  private readonly _isValid$: Observable<boolean>;\r\n  private readonly _distance$ = new BehaviorSubject<number | null>(null);\r\n\r\n  private readonly _plotItem$ = new BehaviorSubject<PlotItem | null>(null);\r\n\r\n  constructor(private readonly _delete: (item: PlotBuilderItem) => void) {\r\n    super();\r\n    this._isValid$ = combineLatest([this._distance$]).pipe(\r\n      map(() => this.isValid)\r\n    );\r\n\r\n    combineLatest([this._distance$]).subscribe(([distace]) => {\r\n      if (!this.isValid) {\r\n        this._plotItem$.next(null);\r\n        return;\r\n      }\r\n\r\n      this._plotItem$.next({\r\n        type: \"heat-vortex\",\r\n        distance: distace!,\r\n      });\r\n    });\r\n  }\r\n\r\n  static fromJSON(\r\n    json: any,\r\n    del: (item: PlotBuilderItem) => void\r\n  ): HeatVortexPlotBuilderItem {\r\n    const item = new HeatVortexPlotBuilderItem(del);\r\n    item.setDistance(json.distance);\r\n    return item;\r\n  }\r\n\r\n  toJSON() {\r\n    return {\r\n      type: \"heat-vortex\",\r\n      distance: this._distance$.value,\r\n    };\r\n  }\r\n\r\n  get isValid$() {\r\n    return this._isValid$;\r\n  }\r\n\r\n  get isValid() {\r\n    const distance = this._distance$.value;\r\n    return distance != null && distance >= 0;\r\n  }\r\n\r\n  get plotItem$(): Observable<PlotItem | null> {\r\n    return this._plotItem$;\r\n  }\r\n\r\n  get plotItem(): PlotItem | null {\r\n    return this._plotItem$.value;\r\n  }\r\n\r\n  get distance$(): Observable<number | null> {\r\n    return this._distance$;\r\n  }\r\n\r\n  setDistance(distance: number | null) {\r\n    this._distance$.next(distance);\r\n  }\r\n\r\n  delete() {\r\n    this._delete(this);\r\n  }\r\n}\r\n","import { last } from \"lodash\";\r\nimport { inject, injectable, singleton } from \"microinject\";\r\n\r\nimport { POTION_RADIUS } from \"@/game-settings\";\r\nimport { curveToPoints } from \"@/curves\";\r\nimport {\r\n  PointArray,\r\n  pointArrayLengthCached,\r\n  pointArrayLineFromDistance,\r\n  takePointArrayByDistance,\r\n} from \"@/point-array\";\r\nimport {\r\n  Point,\r\n  pointAdd,\r\n  pointAngleRadians,\r\n  pointDistance,\r\n  pointEquals,\r\n  pointMagnitude,\r\n  pointMoveTowards,\r\n  pointNormalize,\r\n  pointRotate,\r\n  pointScale,\r\n  pointSignedAngleDegrees180,\r\n  pointSubtract,\r\n  PointZero,\r\n} from \"@/points\";\r\n\r\nimport { IngredientRegistry } from \"../ingredients/IngredientRegistry\";\r\nimport { PotionMap } from \"../potion-maps/PotionMap\";\r\n\r\nimport {\r\n  AddIngredientPlotItem,\r\n  HeatVortexPlotItem,\r\n  PlotItem,\r\n  PlotResult,\r\n  PourSolventPlotItem,\r\n  StirCauldronPlotItem,\r\n} from \"./types\";\r\nimport { degreesToRadians } from \"@/utils\";\r\n\r\n@injectable()\r\n@singleton()\r\nexport class Plotter {\r\n  constructor(\r\n    @inject(IngredientRegistry) private ingredientRegistry: IngredientRegistry\r\n  ) {}\r\n\r\n  plotItems(items: readonly PlotItem[], map: PotionMap): PlotResult {\r\n    let result: PlotResult = {\r\n      committedPoints: [],\r\n      pendingPoints: [],\r\n    };\r\n\r\n    // return result;\r\n\r\n    const now = Date.now();\r\n\r\n    for (const item of items) {\r\n      result = this._plotItem(item, result, map);\r\n    }\r\n\r\n    for (const point of result.committedPoints.concat(result.pendingPoints)) {\r\n      const entities = map.hitTest(point, POTION_RADIUS);\r\n      point.entities = entities as any;\r\n    }\r\n\r\n    console.log(\"plotting took\", Date.now() - now);\r\n\r\n    return result;\r\n  }\r\n\r\n  private _plotItem(\r\n    item: PlotItem,\r\n    result: PlotResult,\r\n    map: PotionMap\r\n  ): PlotResult {\r\n    switch (item.type) {\r\n      case \"add-ingredient\":\r\n        return this._plotAddIngredient(item, result);\r\n      case \"pour-solvent\":\r\n        return this._plotPourSolvent(item, result);\r\n      case \"stir-cauldron\":\r\n        return this._plotStirCauldron(item, result);\r\n      case \"heat-vortex\":\r\n        return this._plotHeatVortex(item, result, map);\r\n      default:\r\n        throw new Error(`Unknown plot item type: ${(item as any).type}`);\r\n    }\r\n  }\r\n\r\n  private _plotAddIngredient(\r\n    item: AddIngredientPlotItem,\r\n    result: PlotResult\r\n  ): PlotResult {\r\n    const { ingredientId, grindPercent } = item;\r\n\r\n    const addPosition =\r\n      last(result.pendingPoints) ?? last(result.committedPoints) ?? PointZero;\r\n\r\n    const ingredient = this.ingredientRegistry.getIngredientById(ingredientId);\r\n    if (!ingredient) {\r\n      throw new Error(`Unknown ingredient: ${ingredientId}`);\r\n    }\r\n\r\n    const ingredientPoints: PointArray = [];\r\n    let ingredientLength = 0;\r\n    for (const curve of ingredient.path) {\r\n      const points = curveToPoints(curve);\r\n      ingredientPoints.push(...points);\r\n      // Use the cached length, as curveToPoints is cached and will return consistent array references.\r\n      // Note, this produces a very slightly incorrect length. A difference of around e-15 when compared to getting\r\n      // the length of the final ingredientPoints array.\r\n      ingredientLength += pointArrayLengthCached(points);\r\n    }\r\n\r\n    const takePercent =\r\n      ingredient.preGrindPercent +\r\n      grindPercent * (1 - ingredient.preGrindPercent);\r\n\r\n    const [addedPoints] = takePointArrayByDistance(\r\n      ingredientPoints,\r\n      takePercent * ingredientLength\r\n    );\r\n\r\n    const appendPendingPoints = addedPoints.map((point) =>\r\n      pointAdd(addPosition, point)\r\n    );\r\n\r\n    return appendPendingPlotPoints(appendPendingPoints, item, result);\r\n  }\r\n\r\n  private _plotPourSolvent(\r\n    item: PourSolventPlotItem,\r\n    result: PlotResult\r\n  ): PlotResult {\r\n    const currentPoint =\r\n      result.committedPoints[result.committedPoints.length - 1] ?? PointZero;\r\n    if (pointEquals(currentPoint, PointZero)) {\r\n      return result;\r\n    }\r\n\r\n    let { distance } = item;\r\n\r\n    const distanceToOrigin = pointDistance(currentPoint, PointZero);\r\n    if (distance > distanceToOrigin) {\r\n      distance = distanceToOrigin;\r\n    }\r\n\r\n    const newPoints = pointArrayLineFromDistance(\r\n      currentPoint,\r\n      pointNormalize(pointSubtract(PointZero, currentPoint)),\r\n      distance\r\n    );\r\n\r\n    return commitPlotPoints(newPoints, item, result);\r\n  }\r\n\r\n  private _plotStirCauldron(\r\n    item: StirCauldronPlotItem,\r\n    result: PlotResult\r\n  ): PlotResult {\r\n    const { distance } = item;\r\n\r\n    const [addedPoints, remainderPlotPoints] = takePointArrayByDistance(\r\n      result.pendingPoints,\r\n      distance\r\n    );\r\n\r\n    return {\r\n      committedPoints: result.committedPoints.concat(addedPoints),\r\n      pendingPoints: remainderPlotPoints,\r\n    };\r\n  }\r\n\r\n  private _plotHeatVortex(\r\n    item: HeatVortexPlotItem,\r\n    result: PlotResult,\r\n    map: PotionMap\r\n  ): PlotResult {\r\n    const indicatorPosition = last(result.committedPoints) ?? PointZero;\r\n    const vortex = map\r\n      .hitTest(indicatorPosition, POTION_RADIUS)\r\n      .find((x) => x.entityType === \"Vortex\");\r\n\r\n    if (!vortex) {\r\n      return result;\r\n    }\r\n\r\n    const { distance } = item;\r\n\r\n    /* RecipeMapManager.MoveIndicatorTowardsVortex()\r\n    float maxDistanceDelta = this.vortexSettings.vortexMovementFromHeatDependence.Evaluate(Managers.Ingredient.coals.Heat) * this.vortexSettings.vortexMovementSpeed * Time.deltaTime;\r\n    Vector2 localPosition1 = (Vector2) this.currentVortexMapItem.thisTransform.localPosition;\r\n    Vector2 localPosition2 = (Vector2) this.recipeMapObject.indicatorContainer.localPosition;\r\n    Vector2 to = localPosition2 - localPosition1;\r\n    float magnitude = to.magnitude;\r\n    float f1 = Mathf.Sign(this.vortexSettings.vortexSpiralThetaPower) * this.vortexSettings.vortexSpiralStep;\r\n    float f2 = Mathf.Pow((float) ((double) magnitude * 2.0 * 3.14159274101257) / f1, 1f / this.vortexSettings.vortexSpiralThetaPower);\r\n    float b = f2 - maxDistanceDelta * (float) ((int) Mathf.Sign(this.vortexSettings.vortexSpiralThetaPower) * (int) Mathf.Sign(f1));\r\n    float f3 = f2.Is(0.0f) ? 0.0f : ((double) f2 < 0.0 ? Mathf.Min(0.0f, b) : Mathf.Max(0.0f, b));\r\n    double num = (double) f1 * 0.5 / 3.14159274101257 * (double) Mathf.Pow(f3, this.vortexSettings.vortexSpiralThetaPower);\r\n    Vector2 from = magnitude * new Vector2(Mathf.Cos(f2), Mathf.Sin(f2));\r\n    Vector2 vector2_1 = new Vector2(Mathf.Cos(f3), Mathf.Sin(f3));\r\n    Vector2 vector2_2 = ((float) num * vector2_1).Rotate(Vector2.SignedAngle(from, to));\r\n    Vector2 vector2_3 = Vector2.MoveTowards(localPosition2, localPosition1 + vector2_2, maxDistanceDelta);\r\n    this.indicator.targetPosition += vector2_3 - localPosition2;\r\n    this.recipeMapObject.indicatorContainer.localPosition = (Vector3) vector2_3;\r\n    */\r\n\r\n    // VortexSettings\r\n    const vortexMovementFromHeatDependence10Percent = 0.19;\r\n    const vortexMovementSpeed = 2.5;\r\n    const vortexSpiralStep = 1;\r\n    const vortexSpiralThetaPower = 1;\r\n\r\n    // Calculate the step as if we were running at 10% heat at 60 frames a second.\r\n    const step =\r\n      vortexMovementFromHeatDependence10Percent *\r\n      vortexMovementSpeed *\r\n      (1 / 60);\r\n\r\n    let remainingDistance = distance;\r\n    let currentPosition = indicatorPosition;\r\n    const pointsToAdd: Point[] = [indicatorPosition];\r\n    while (remainingDistance > 0) {\r\n      const to = pointSubtract(currentPosition, vortex);\r\n      const magnitude = pointMagnitude(to);\r\n      const f1 = Math.sign(vortexSpiralThetaPower) * vortexSpiralStep;\r\n      const f2 = Math.pow(\r\n        (magnitude * 2.0 * Math.PI) / f1,\r\n        1 / vortexSpiralThetaPower\r\n      );\r\n      const b = f2 - step * (Math.sign(vortexSpiralThetaPower) * Math.sign(f1));\r\n      const f3 =\r\n        Math.abs(f2) < Number.EPSILON\r\n          ? 0\r\n          : f2 < 0.0\r\n          ? Math.min(0.0, b)\r\n          : Math.max(0.0, b);\r\n      const num = ((f1 * 0.5) / Math.PI) * Math.pow(f3, vortexSpiralThetaPower);\r\n      const from = pointScale({ x: Math.cos(f2), y: Math.sin(f2) }, magnitude);\r\n      const vector2_1 = { x: Math.cos(f3), y: Math.sin(f3) };\r\n\r\n      const rotation = degreesToRadians(pointSignedAngleDegrees180(from, to));\r\n      const vector2_2 = pointRotate(pointScale(vector2_1, num), rotation);\r\n      const vector2_3 = pointMoveTowards(\r\n        currentPosition,\r\n        pointAdd(vortex, vector2_2),\r\n        step\r\n      );\r\n\r\n      currentPosition = vector2_3;\r\n      pointsToAdd.push(currentPosition);\r\n\r\n      remainingDistance = Math.max(0, remainingDistance - step);\r\n    }\r\n\r\n    return commitPlotPoints(pointsToAdd, item, result);\r\n  }\r\n}\r\n\r\nfunction appendPendingPlotPoints(\r\n  points: Point[],\r\n  source: PlotItem,\r\n  result: PlotResult\r\n): PlotResult {\r\n  if (source == null) {\r\n    throw new Error(\"source is null\");\r\n  }\r\n\r\n  if (points.length === 0) {\r\n    return result;\r\n  }\r\n\r\n  return Object.assign({}, result, {\r\n    pendingPoints: result.pendingPoints.concat(\r\n      points.map((point) => ({\r\n        x: point.x,\r\n        y: point.y,\r\n        source,\r\n        entities: [],\r\n      }))\r\n    ),\r\n  });\r\n}\r\n\r\nfunction commitPlotPoints(\r\n  points: Point[],\r\n  source: PlotItem,\r\n  result: PlotResult\r\n): PlotResult {\r\n  if (source == null) {\r\n    throw new Error(\"source is null\");\r\n  }\r\n\r\n  if (points.length === 0) {\r\n    return result;\r\n  }\r\n\r\n  const difference = pointSubtract(\r\n    last(points)!,\r\n    last(result.committedPoints) ?? PointZero\r\n  );\r\n\r\n  return Object.assign({}, result, {\r\n    committedPoints: result.committedPoints.concat(\r\n      points.map((point) => ({\r\n        x: point.x,\r\n        y: point.y,\r\n        source,\r\n        entities: [],\r\n      }))\r\n    ),\r\n    pendingPoints: result.pendingPoints.map((point) => ({\r\n      x: point.x + difference.x,\r\n      y: point.y + difference.y,\r\n      source: point.source,\r\n    })),\r\n  });\r\n}\r\n","import { ContainerModule } from \"microinject\";\r\n\r\nimport { PlotBuilder } from \"./PlotBuilder\";\r\nimport { Plotter } from \"./Plotter\";\r\n\r\nexport default new ContainerModule((bind) => {\r\n  bind(PlotBuilder);\r\n  bind(Plotter);\r\n});\r\n","import { Point } from \"@/points\";\r\n\r\nimport { IngredientId } from \"../ingredients/types\";\r\nimport { MapEntity } from \"../potion-maps/types\";\r\n\r\nexport type PlotItem =\r\n  | AddIngredientPlotItem\r\n  | PourSolventPlotItem\r\n  | StirCauldronPlotItem\r\n  | HeatVortexPlotItem;\r\n\r\nexport interface AddIngredientPlotItem {\r\n  type: \"add-ingredient\";\r\n  ingredientId: IngredientId;\r\n  grindPercent: number;\r\n}\r\n\r\nexport interface PourSolventPlotItem {\r\n  type: \"pour-solvent\";\r\n  distance: number;\r\n}\r\n\r\nexport interface StirCauldronPlotItem {\r\n  type: \"stir-cauldron\";\r\n  distance: number;\r\n}\r\n\r\nexport interface HeatVortexPlotItem {\r\n  type: \"heat-vortex\";\r\n  distance: number;\r\n}\r\n\r\nexport interface PlotPoint extends Point {\r\n  source: PlotItem;\r\n  entities: Readonly<MapEntity>[];\r\n}\r\n\r\nexport interface PlotResult {\r\n  committedPoints: PlotPoint[];\r\n  pendingPoints: PlotPoint[];\r\n}\r\n\r\nexport const EmptyPlotResult: Readonly<PlotResult> = Object.freeze({\r\n  committedPoints: [],\r\n  pendingPoints: [],\r\n}) as any;\r\n","import { injectable, singleton } from \"microinject\";\r\n\r\nimport { typedKeys } from \"@/utils\";\r\n\r\nimport { PotionBaseMaps } from \"../potion-maps/maps\";\r\nimport { PotionMap } from \"../potion-maps/PotionMap\";\r\nimport { PotionBaseId, PotionBase } from \"./types\";\r\n\r\n@injectable()\r\n@singleton()\r\nexport class PotionBaseRegistry {\r\n  private readonly _potionBasesById: Record<PotionBaseId, PotionBase> = {};\r\n\r\n  constructor() {\r\n    for (const key of typedKeys(PotionBaseMaps)) {\r\n      const id = key as PotionBaseId;\r\n      const base: PotionBase = {\r\n        id,\r\n        map: new PotionMap(PotionBaseMaps[key]),\r\n      };\r\n      this._potionBasesById[id] = base;\r\n    }\r\n  }\r\n\r\n  getPotionBaseById(id: PotionBaseId): PotionBase | null {\r\n    return this._potionBasesById[id] ?? null;\r\n  }\r\n}\r\n","import { ContainerModule } from \"microinject\";\r\nimport { PotionBaseRegistry } from \"./PotionBaseRegistry\";\r\n\r\nexport default new ContainerModule((bind) => {\r\n  bind(PotionBaseRegistry);\r\n});\r\n","import { uniq } from \"lodash\";\r\n\r\nimport { Point } from \"@/points\";\r\nimport { rectFromCircle } from \"@/rectangles\";\r\n\r\nimport {\r\n  getRegionIndexesFromRect,\r\n  getRegionIndexFromPoint,\r\n  REGION_COUNT,\r\n} from \"./regions\";\r\nimport { MapEntity } from \"./types\";\r\nimport { EntityDefs } from \"./entity-defs\";\r\n\r\nexport class PotionMap {\r\n  private _entityRegions: MapEntity[][] | null = null;\r\n\r\n  constructor(private _entities: readonly Readonly<MapEntity>[]) {}\r\n\r\n  get entities(): readonly Readonly<MapEntity>[] {\r\n    return this._entities;\r\n  }\r\n\r\n  hitTest(p: Point, radius = 0): readonly Readonly<MapEntity>[] {\r\n    const regions = this._getEntityRegions();\r\n\r\n    const indexes =\r\n      radius <= 0\r\n        ? [getRegionIndexFromPoint(p)]\r\n        : getRegionIndexesFromRect(rectFromCircle(p, radius));\r\n\r\n    const entities = uniq(\r\n      ([] as MapEntity[]).concat(...indexes.map((index) => regions[index]))\r\n    );\r\n\r\n    const result: MapEntity[] = [];\r\n    for (const entity of entities) {\r\n      const entityDef = EntityDefs[entity.entityType];\r\n      if (!entityDef) {\r\n        continue;\r\n      }\r\n\r\n      if (entityDef.hitTest(p, entity, radius)) {\r\n        result.push(entity);\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  private _getEntityRegions(): MapEntity[][] {\r\n    if (this._entityRegions) {\r\n      return this._entityRegions;\r\n    }\r\n\r\n    this._entityRegions = new Array(REGION_COUNT);\r\n    for (let i = 0; i < REGION_COUNT; i++) {\r\n      this._entityRegions[i] = [];\r\n    }\r\n\r\n    for (const entity of this._entities) {\r\n      const entityDef = EntityDefs[entity.entityType];\r\n      if (!entityDef) {\r\n        continue;\r\n      }\r\n      const bounds = entityDef.getBounds(entity);\r\n      const indexes = getRegionIndexesFromRect(bounds);\r\n      for (const index of indexes) {\r\n        this._entityRegions[index].push(entity);\r\n      }\r\n    }\r\n\r\n    return this._entityRegions;\r\n  }\r\n}\r\n","import { POTION_RADIUS } from \"@/game-settings\";\r\nimport {\r\n  Point,\r\n  pointAdd,\r\n  pointMagnitude,\r\n  pointRotate,\r\n  pointSubtract,\r\n} from \"@/points\";\r\nimport {\r\n  rectangle,\r\n  Rectangle,\r\n  rectFromCircle,\r\n  rectOffset,\r\n  pointIntersectsRect,\r\n} from \"@/rectangles\";\r\n\r\nimport { MapEntity } from \"./types\";\r\n\r\nexport interface EntityDefinition {\r\n  readonly entityType: MapEntity[\"entityType\"];\r\n  getFriendlyName(entity: MapEntity): string;\r\n  getBounds(entity: MapEntity): Rectangle;\r\n  hitTest(p: Point, entity: MapEntity, radius?: number): boolean;\r\n}\r\n\r\nconst VortexRadii = {\r\n  Large: 1.65,\r\n  Medium: 1.25,\r\n} as const;\r\n\r\nexport const EntityDefs: Record<MapEntity[\"entityType\"], EntityDefinition> = {\r\n  PotionEffect: {\r\n    entityType: \"PotionEffect\",\r\n    getFriendlyName(entity: MapEntity) {\r\n      const effectEntity = assertEntity(entity, \"PotionEffect\");\r\n      return effectEntity.effect;\r\n    },\r\n    getBounds(entity: MapEntity) {\r\n      return rectFromCircle(entity, POTION_RADIUS);\r\n    },\r\n    hitTest(p: Point, entity: MapEntity, radius = 0) {\r\n      return pointMagnitude(pointSubtract(p, entity)) - radius <= POTION_RADIUS;\r\n    },\r\n  },\r\n  // NOTE: This should be replaced by something that knows the different hitboxes of each type.\r\n  // This would be complicated, as many of them are rects and rotation needs to be taken into account.\r\n  DangerZonePart: {\r\n    entityType: \"DangerZonePart\",\r\n    getFriendlyName(entity: MapEntity) {\r\n      const boneEntity = assertEntity(entity, \"DangerZonePart\");\r\n      // return boneEntity.prefab;\r\n      return \"Bone\";\r\n    },\r\n    getBounds(entity: MapEntity) {\r\n      const bone = assertEntity(entity, \"DangerZonePart\");\r\n      // FIXME: hack.  Use the actual hitboxes\r\n      switch (bone.prefab) {\r\n        case \"Fang1\":\r\n          // Need to cover all rotations, so use the largest axis for both.\r\n          return rectOffset(rectangle(-0.06, -0.06, 0.12, 0.12), entity);\r\n        case \"Fang2\":\r\n          // Need to cover all rotations, so use the largest axis for both.\r\n          return rectOffset(rectangle(-0.12, -0.12, 0.24, 0.24), entity);\r\n        case \"Bone1\":\r\n          // Need to cover all rotations, so use the largest axis for both.\r\n          return rectOffset(rectangle(-0.345, -0.345, 0.69, 0.69), entity);\r\n        case \"Bone2\":\r\n          // Need to cover all rotations, so use the largest axis for both.\r\n          return rectOffset(rectangle(-0.32, -0.32, 0.72, 0.72), entity);\r\n        case \"Skull1\":\r\n        default:\r\n          return rectFromCircle(entity, 0.24);\r\n      }\r\n    },\r\n    hitTest(p: Point, entity: MapEntity, radius = 0) {\r\n      const bone = assertEntity(entity, \"DangerZonePart\");\r\n      if (bone.prefab === \"Skull1\") {\r\n        return false; //pointMagnitude(pointSubtract(p, entity)) - radius <= 0.24;\r\n      }\r\n\r\n      let r: Rectangle;\r\n      switch (bone.prefab) {\r\n        case \"Fang1\":\r\n          r = rectangle(-0.06, -0.02, 0.12, 0.4);\r\n          break;\r\n        case \"Fang2\":\r\n          r = rectangle(-0.065, -0.12, 0.13, 0.24);\r\n          break;\r\n        case \"Bone1\":\r\n          r = rectangle(-0.06, -0.345, 0.12, 0.69);\r\n          break;\r\n        case \"Bone2\":\r\n          r = rectangle(-0.07, -0.36, 0.14, 0.72);\r\n          break;\r\n        default:\r\n          return false;\r\n      }\r\n      r = rectOffset(r, entity);\r\n\r\n      // get it aligned with the hitbox\r\n      p = pointAdd(pointRotate(pointSubtract(p, entity), -bone.angle), entity);\r\n\r\n      // https://stackoverflow.com/questions/21089959/detecting-collision-of-rectangle-with-circle\r\n      const w = r.p2.x - r.p1.x;\r\n      const h = r.p2.y - r.p1.y;\r\n      const distX = Math.abs(p.x - r.p1.x - w / 2);\r\n      const distY = Math.abs(p.y - r.p1.y - w / 2);\r\n\r\n      if (distX > w / 2 + radius) {\r\n        return false;\r\n      }\r\n      if (distY > h / 2 + radius) {\r\n        return false;\r\n      }\r\n\r\n      if (distX <= w / 2) {\r\n        return true;\r\n      }\r\n      if (distY <= h / 2) {\r\n        return true;\r\n      }\r\n\r\n      var dx = distX - w / 2;\r\n      var dy = distY - h / 2;\r\n      return dx * dx + dy * dy <= radius * radius;\r\n    },\r\n  },\r\n  ExperienceBonus: {\r\n    entityType: \"ExperienceBonus\",\r\n    getFriendlyName(entity: MapEntity) {\r\n      const expEntity = assertEntity(entity, \"ExperienceBonus\");\r\n      return `${expEntity.prefab} XP Bonus`;\r\n    },\r\n    getBounds: (entity: MapEntity): Rectangle => {\r\n      // FIXME: Arent these different sizes?\r\n      return rectFromCircle(entity, 0.3);\r\n    },\r\n    hitTest: (p: Point, entity: MapEntity, radius = 0): boolean => {\r\n      return pointMagnitude(pointSubtract(p, entity)) - radius <= 0.3;\r\n    },\r\n  },\r\n  Vortex: {\r\n    entityType: \"Vortex\",\r\n    getFriendlyName(entity: MapEntity) {\r\n      return \"Vortex\";\r\n    },\r\n    getBounds: (entity: MapEntity): Rectangle => {\r\n      const vortex = assertEntity(entity, \"Vortex\");\r\n      const radius = VortexRadii[vortex.prefab];\r\n      return rectFromCircle(entity, radius);\r\n    },\r\n    hitTest: (p: Point, entity: MapEntity, radius = 0): boolean => {\r\n      const vortex = assertEntity(entity, \"Vortex\");\r\n      const vortexRadius = VortexRadii[vortex.prefab];\r\n      return pointMagnitude(pointSubtract(p, entity)) - radius <= vortexRadius;\r\n    },\r\n  },\r\n};\r\n\r\nfunction assertEntity<T extends MapEntity[\"entityType\"]>(\r\n  entity: MapEntity,\r\n  type: T\r\n): MapEntity & { entityType: T } {\r\n  if (entity.entityType === type) {\r\n    return entity as any;\r\n  }\r\n  throw new Error(`Expected entity to be of type ${type}`);\r\n}\r\n","import { MapEntity } from \"../types\";\r\n\r\nconst water = Object.freeze(require(\"./water.json\")) as MapEntity[];\r\n\r\nexport const PotionBaseMaps = {\r\n  water,\r\n};\r\n","import { first } from \"lodash\";\r\n\r\nimport { MAP_EXTENT_RADIUS } from \"@/game-settings\";\r\nimport { Point, pointAdd } from \"@/points\";\r\nimport { Rectangle } from \"@/rectangles\";\r\n\r\nconst MAP_WIDTH = MAP_EXTENT_RADIUS * 2;\r\nconst MAP_HEIGHT = MAP_EXTENT_RADIUS * 2;\r\nconst REGION_WIDTH = 0.5;\r\nconst REGION_HEIGHT = 0.5;\r\n\r\nconst ORIGIN_OFFSET: Point = { x: MAP_EXTENT_RADIUS, y: MAP_EXTENT_RADIUS };\r\n\r\nexport const REGION_COUNT =\r\n  (MAP_WIDTH / REGION_WIDTH) * (MAP_HEIGHT / REGION_HEIGHT) + 1;\r\nexport const FALLBACK_REGION = REGION_COUNT - 1;\r\n\r\nexport function getRegionIndexFromPoint(p: Point): number {\r\n  return first(getRegionIndexesFromRect({ p1: p, p2: p }))!;\r\n}\r\n\r\nexport function getRegionIndexesFromRect(r: Rectangle): number[] {\r\n  let { p1, p2 } = r;\r\n  p1 = pointAdd(p1, ORIGIN_OFFSET);\r\n  p2 = pointAdd(p2, ORIGIN_OFFSET);\r\n\r\n  let x1 = Math.floor(p1.x / REGION_WIDTH);\r\n  let y1 = Math.floor(p1.y / REGION_HEIGHT);\r\n  let x2 = Math.ceil(p2.x / REGION_WIDTH);\r\n  let y2 = Math.ceil(p2.y / REGION_HEIGHT);\r\n\r\n  const indexes = [];\r\n\r\n  let addedOOB = false;\r\n  const addOOB = () => {\r\n    if (addedOOB) {\r\n      return;\r\n    }\r\n    indexes.push(FALLBACK_REGION);\r\n    addedOOB = true;\r\n  };\r\n\r\n  if (x1 < 0) {\r\n    x1 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (x2 < 0) {\r\n    x2 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (x1 >= MAP_WIDTH / REGION_WIDTH) {\r\n    x1 = MAP_WIDTH / REGION_WIDTH - 1;\r\n    addOOB();\r\n  }\r\n\r\n  if (x2 >= MAP_WIDTH / REGION_WIDTH) {\r\n    x2 = MAP_WIDTH / REGION_WIDTH - 1;\r\n    addOOB();\r\n  }\r\n\r\n  if (y1 < 0) {\r\n    y1 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (y2 < 0) {\r\n    y2 = 0;\r\n    addOOB();\r\n  }\r\n\r\n  if (y1 >= MAP_HEIGHT / REGION_HEIGHT) {\r\n    y1 = MAP_HEIGHT / REGION_HEIGHT - 1;\r\n    addOOB();\r\n  }\r\n\r\n  if (y2 >= MAP_HEIGHT / REGION_HEIGHT) {\r\n    y2 = MAP_HEIGHT / REGION_HEIGHT - 1;\r\n    addOOB();\r\n  }\r\n\r\n  for (let x = x1; x <= x2; x++) {\r\n    for (let y = y1; y <= y2; y++) {\r\n      indexes.push(x + y * (MAP_WIDTH / REGION_WIDTH));\r\n    }\r\n  }\r\n\r\n  return indexes;\r\n}\r\n","export interface Size {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport const SizeZero = Object.freeze({ width: 0, height: 0 }) as any;\r\n","import { ThemeProvider } from \"@emotion/react\";\r\nimport { createTheme } from \"@mui/material/styles\";\r\nimport React from \"react\";\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    mode: \"light\",\r\n  },\r\n});\r\n\r\nexport interface AppThemeProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst AppThemeProvider = ({ children }: AppThemeProviderProps) => (\r\n  <ThemeProvider theme={theme}>{children}</ThemeProvider>\r\n);\r\n\r\nexport default AppThemeProvider;\r\n","import { Value } from \"classnames\";\r\n\r\nexport function windowArray<T>(array: T[], count: number): T[][] {\r\n  const a = [...array];\r\n\r\n  let result: T[][] = [];\r\n  let window: T[] = [];\r\n\r\n  while (a.length > 0) {\r\n    window.push(a.pop()!);\r\n    if (window.length === count) {\r\n      result.push(window);\r\n      window = [];\r\n    }\r\n  }\r\n\r\n  if (window.length > 0) {\r\n    result.push(window);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nexport function keepEveryK<T>(array: T[], k: number, keepLast = false) {\r\n  if (array.length === 0) {\r\n    return array;\r\n  }\r\n\r\n  const a = [];\r\n  for (let i = 0; i < array.length; i += k) {\r\n    a.push(array[i]);\r\n  }\r\n  if (keepLast && (array.length - 1) % k !== 0) {\r\n    a.push(array[array.length - 1]);\r\n  }\r\n  return a;\r\n}\r\n\r\nexport function isNotNull<T>(x: T | null | undefined): x is T {\r\n  return x != null;\r\n}\r\n\r\nexport function typedKeys<T>(obj: T): (keyof T)[] {\r\n  return Object.keys(obj) as any;\r\n}\r\n\r\nexport function degreesToRadians(degress: number): number {\r\n  return (degress * Math.PI) / 180;\r\n}\r\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","undefined","className","value","rate","onChange","onChangeCommitted","useState","delta","setDelta","useEffect","token","setInterval","clearInterval","Slider","min","max","step","e","v","StyledTooltip","styled","Tooltip","tooltipPlacementLeft","margin","allowEmpty","onMouseOverItem","onMouseOutItem","props","registry","useDIDependency","IngredientRegistry","onSelectChange","useCallback","target","Select","MenuItem","getIngredients","map","ingredient","key","onMouseOver","onMouseOut","placement","title","width","height","viewBox","MAX_INGREDIENT_EXTENT","transform","cx","cy","r","POTION_RADIUS","fill","d","path","reduce","curve","start","x","y","p1","p2","end","stroke","strokeWidth","ListItemText","name","Root","backgroundColor","overflow","imgCache","Map","makeImg","src","has","get","img","Image","onerror","console","error","bind","set","MapSlotSrc","renderEntity","ctx","entity","entityType","save","translate","rotate","degreesToRadians","angle","DangerZoneImageSrces","prefab","w","h","scale","drawImage","restore","renderDangerZonePart","grad","createLinearGradient","addColorStop","strokeStyle","lineWidth","beginPath","moveTo","lineTo","container","EffectSlotSrc","containerW","containerH","PotionEffectImageSrces","effect","renderPotionEffectEntity","ExperienceBonusImagesSrc","renderExperienceBonusEntity","VortexImagesSrc","renderVortexEntity","viewModel","useObservation","viewportSize$","SizeZero","offset","viewOffset$","PointZero","viewScale$","canvasRef","setCanvasRef","entities","requestAnimationFrame","getContext","clearRect","zoomFactor","offsetX","offsetY","handler","MAP_EXTENT_RADIUS","transformToMap","mapSlotW","mapSlotH","cancelAnimationFrame","ref","Bone1","Bone2","Fang1","Fang2","Skull1","Acid","Berserker","Bounce","Charm","Crop","Explosion","Fire","Fly","Frost","Growth","Hallucinations","Healing","Invisibility","Libido","Light","Lightning","Mana","Necromancy","Poison","SharpVision","Sleep","SlowDown","StoneSkin","Little","Medium","Large","ZOOM_FACTOR","PAN_FACTOR","children","containerRef","React","useRef","containerBounds","useComponentBounds","dragPointer","setDragPointer","mouseLastPos","setMouseLastPos","useLayoutEffect","onViewportResized","onWheel","current","defaultPrevented","modifiers","getModifiers","ctrlMetaKey","zoom","deltaY","clientX","clientY","preventDefault","stopPropagation","shiftKey","pan","onPointerDown","pointerId","currentTarget","setPointerCapture","onPointerMove","p","pointSubtract","onPointerUp","releasePointerCapture","useNativeEvent","passive","onMouseMove","theme","boxSixing","display","flexDirection","listStyle","paddingLeft","spacing","paddingRight","position","marginBottom","top","right","alignSelf","alignItems","PlotListItem","memo","item","highlight","AddIngredientPlotBuilderItem","AddIngredientPlotListItem","StirCauldronPlotBuilderItem","StirCauldronPlotListItem","PourSolventPlotBuilderItem","PourSolventPlotListItem","HeatVortexPlotBuilderItem","HeatVortexPlotListItem","constructor","PlotListItemCard","valid","isValid$","onCardMouseOver","onDeleteClick","delete","Card","style","IconButton","size","onClick","Delete","CardContent","savedIngredientRef","isPreviewing","setIsPreviewing","isPreviewingRef","localGrind","setLocalGrind","inputGrindPercent","setInputGrindPercent","ingredientId","ingredientId$","grindPercent","grindPercent$","onIngredientSelectorOpen","onIngredientSelectorMouseOverItem","setIngredient","onIngredientSelectorChange","onIngredientSelectorClose","onGrindPercentTextChange","asNumber","Number","isNaN","setGrindPercent","onGrindPercentBlur","onSliderChange","_","onSliderChangeCommitted","displayIngredientId","Typography","variant","fullWidth","onOpen","onClose","Grid","paddingTop","TextField","label","onBlur","distance","distance$","inputDistance","setInputDistance","onTextFieldChange","setDistance","onTextFieldBlur","onDistanceChange","Math","toFixed","builder","highlightItem","items","items$","i","Button","color","addIngredient","Add","addStirCauldron","addPourSolvent","addHeatVortex","left","bottom","background","useDICreate","PlotEditorViewModel","PotionBaseRegistry","getPotionBaseById","inspectPoint","bottlePreviewPoint$","inspectSource","mouseOverPlotItem$","inspectEntity","mouseOverEntity$","plot","plot$","useTransition","mouseOverBuilderItem$","outputShareString","shareString$","mouseWorld","mouseWorldPosition$","query","URLSearchParams","window","location","search","data","loadFromShareString","history","replaceState","toString","onBuildItemMouseOver","onMouseOverBuilderItem","onBuildItemMouseOut","EmptyPlotResult","point","setZoom","_builder","_viewportSize$","BehaviorSubject","_viewOffset$","_viewScale$","_mouseClientPosition$","_mouseOverPlotItem$","_mouseOverBuilderItem$","this","_shareString$","pipe","debounceTime","getShareString","_mouseWorldPosition$","combineLatest","clientPos","_clientToWorld","_mouseOverEntity$","map$","worldPos","hitTest","first","_bottlePreviewPoint$","plotItem","plotItemPoints","committedPoints","concat","pendingPoints","filter","source","closestPlotItem","length","pointDistance","on","prevWorld","next","world","pointAdd","dx","dy","applyZoom","z","prevSize","scaleFactor","onMouseOverPlotItem","builderItemFor","_worldToClient","inject","PlotBuilder","content","PotionEffectMapEntityDetails","VortexMapEntityDetails","isIngredientPoint","type","itemIsEffect","ingredientRegistry","endsAt","last","useMemo","allPoints","ingredients","uniq","effects","result","find","tier","pointMagnitude","clamp","effectPowerDistanceDependence","abs","EPSILON","getEffects","baseCost","ingredientTypeCounts","getIngredientById","price","pointArrayLength","sqrt","sum","Object","keys","pow","longestLength","currentLength","prevItem","some","longestDangerLength","totalIngredients","totalUniqueIngredients","stress","longestDanger","join","touchedItems","EntityDefs","getFriendlyName","AddIngredientRoot","justifyContent","AddIngredient","pointerEvents","PlotLine","line","pending","usePlotViewModel","points","evenOdd","onPathMouseOver","onPathMouseOut","lighten","hex","str","bottlePreviewPoint","onLineMouseOver","onLineMouseOut","committed","trim","currentLine","sourceCounter","commitedLines","pendingLines","lastSource","keepEveryK","resultToPlotLines","committedLines","PlotViewModelContext","Provider","opacity","createContext","plotViewModel","useContext","Error","modules","composeModules","ContainerContext","Container","useDIContainer","toConstantValue","load","ContainerProvider","identifier","parameters","valRef","create","getCurvePoint","t","b1","b2","b3","b4","startX","startY","p1x","p1y","p2x","p2y","endx","endy","curveLengthCache","getCurveLength","resolution","BEZIER_CURVE_LENGTH_RESOLUTION","cached","previousPoint","index","vector2_2","curvePointsCache","PATH_SPACING_PHYSICS","remainingDistance","samplePointCount","ceil","splitPoint","pointScale","pointNormalize","freeze","setSize","observer","ResizeObserver","el","b","getBoundingClientRect","observe","disconnect","listener","listenTarget","addEventListener","removeEventListener","observable","onError","val","setVal","Observable","subscribe","startTransition","unsubscribe","rootEl","document","getElementById","ReactDOM","createRoot","render","StrictMode","MODIFIER_KEYS_NONE","ctrlKey","altKey","metaKey","keyboardModifierUseMeta","event","pointArray","pointArrayLengthCache","direction","array","takeLength","totalLength","taken","remainder","takenLength","remainingLength","linearInterpolate","assign","slice","pointAngleDegrees180","from","to","num","acos","pointDot","a","factor","atan2","maxDistanceDelta","mt1","mt2","mt3","mt4","sign","angleInRadians","cos","sin","magnitude","lerp","normalizeRectangle","args","RectZero","radius","osPlatform","os","family","OSType","test","isProd","injectable","singleton","cubicBezierCurve","preGrindPercent","ContainerModule","potionBaseRegistry","plotter","_map$","_items$","_itemSubscription","_plot$","plotItem$","plotItems","isNotNull","dataStr","decode","version","DataView","getUint8","JSON","parse","inflate","fromJSON","_deleteItem","toJSON","encoded","deflate","stringify","Uint8Array","buffer","setUint8","encode","Plotter","PlotBuilderItem","_delete","_ingredientId$","_grindPercent$","_plotItem$","_isValid$","isValid","json","del","percent","_distance$","stirDistance","distace","now","Date","_plotItem","log","_plotAddIngredient","_plotPourSolvent","_plotStirCauldron","_plotHeatVortex","addPosition","ingredientPoints","ingredientLength","curveToPoints","pointArrayLengthCached","takePercent","appendPendingPlotPoints","takePointArrayByDistance","currentPoint","pointEquals","distanceToOrigin","commitPlotPoints","pointArrayLineFromDistance","addedPoints","remainderPlotPoints","indicatorPosition","vortex","vortexMovementFromHeatDependence10Percent","currentPosition","pointsToAdd","f1","f2","PI","f3","vector2_1","rotation","pointSignedAngleDegrees180","pointRotate","pointMoveTowards","difference","_potionBasesById","typedKeys","PotionBaseMaps","base","PotionMap","_entities","_entityRegions","regions","_getEntityRegions","indexes","getRegionIndexFromPoint","getRegionIndexesFromRect","rectFromCircle","entityDef","Array","REGION_COUNT","bounds","getBounds","VortexRadii","assertEntity","PotionEffect","DangerZonePart","rectOffset","rectangle","bone","distX","distY","ExperienceBonus","expEntity","Vortex","vortexRadius","water","MAP_WIDTH","MAP_HEIGHT","REGION_WIDTH","REGION_HEIGHT","ORIGIN_OFFSET","x1","floor","y1","x2","y2","addedOOB","addOOB","FALLBACK_REGION","createTheme","palette","mode","ThemeProvider","count","pop","k","keepLast","obj","degress"],"sourceRoot":""}